# HealthPrep Vulnerability Remediation Log

**Document Purpose:** Track container image and dependency vulnerabilities identified by AWS Inspector, remediation actions taken, and known exceptions for HITRUST compliance evidence. This document provides **complete accountability** for every CVE finding—either through remediation or documented risk acceptance with compensating controls.

**Related Documents:**
- `/docs/HITRUST_READINESS.md` - HITRUST readiness checklist
- `/docs/security/dr-drill-log.md` - DR drill execution records
- `/docs/security/vendor-risk-assessments.md` - Third-party vendor risk assessments
- `Dockerfile` - Container security configuration

---

## Scanning Configuration

| Setting | Value |
|---------|-------|
| Scanning Tool | AWS Inspector v2 |
| Region | us-east-2 |
| Scan Type | ECR Container Image Scanning (continuous) |
| Scan Frequency | On push + daily automatic rescan |
| First Scan Date | 2026-02-03 |
| Last Review Date | 2026-02-04 |

---

## CVE Accountability Matrix

**Principle:** Every CVE identified by AWS Inspector MUST be accounted for through one of:
1. **REMEDIATED** - Fix applied and verified
2. **ACCEPTED RISK** - Documented exception with compensating controls
3. **PENDING VENDOR** - Awaiting upstream fix with monitoring plan

### Summary by Category (Based on Inspector Scan 2026-02-04)

| Category | CVE IDs | Count | Status |
|----------|---------|-------|--------|
| Application-Controlled (Python packages) | CVE-2026-24049, CVE-2026-23949 | 2 | Remediated in Dockerfile |
| Vendor-Dependent (Debian base image) | CVE-2025-69419, CVE-2025-69421, CVE-2026-22795, CVE-2025-69418, CVE-2025-11187, CVE-2026-25210, CVE-2025-7709 | 7 | Accepted Risk with Controls |
| **Total Unique CVEs** | — | **9** | **100% Tracked** |

**Current Active Findings (2026-02-04):** 2 (1 Medium, 1 Informational) - See `/docs/security/inspector-findings-summary.md`

**Note:** Inspector may report duplicates across multiple image layers; the above represents unique CVE IDs.

---

## Section 1: Application-Controlled Vulnerabilities (REMEDIATED)

These vulnerabilities are in packages we directly control and have been patched in our Dockerfile.

### CVE-2026-24049 - wheel (Python)

| Field | Value |
|-------|-------|
| **Severity** | HIGH |
| **CVSS 3.1 Score** | **7.1** |
| **Attack Vector** | Local (AV:L) |
| **Attack Complexity** | Low |
| **Privileges Required** | None |
| **User Interaction** | Required |
| **Package** | wheel (Python) |
| **Vulnerable Versions** | 0.40.0 through 0.46.1 |
| **Fixed Version** | 0.46.2 |
| **Vulnerability Type** | Path Traversal (CWE-22, CWE-732) |
| **Impact** | The `unpack` function mishandles file permissions after extraction, allowing attackers to craft malicious `.whl` files that modify permissions on critical system files |
| **Status** | **REMEDIATED** |
| **Remediation Date** | 2026-02-03 |
| **Remediation Action** | Updated Dockerfile to upgrade `wheel>=0.46.2` with build-time version assertion |
| **Evidence** | `Dockerfile` lines 26, 58, 66, 75 |
| **Verification** | Build-time Python assertion fails if wheel < 0.46.2 |

### CVE-2026-23949 - jaraco.context (Python)

| Field | Value |
|-------|-------|
| **Severity** | HIGH |
| **CVSS 3.1 Score** | **8.6** |
| **Attack Vector** | Network (AV:N) |
| **Attack Complexity** | Low |
| **Privileges Required** | None |
| **User Interaction** | None |
| **Scope** | Changed |
| **Package** | jaraco.context (Python) |
| **Vulnerable Versions** | 5.2.0 through <6.1.0 |
| **Fixed Version** | 6.1.0 |
| **Vulnerability Type** | Zip Slip Path Traversal (CWE-22) |
| **Impact** | The `tarball()` function fails to sanitize path traversal sequences (`../`) during tar extraction, allowing file writes outside intended directory |
| **Status** | **REMEDIATED** |
| **Remediation Date** | 2026-02-03 |
| **Remediation Action** | Updated Dockerfile to upgrade `jaraco.context>=6.1.0` with build-time version assertion |
| **Evidence** | `Dockerfile` lines 26, 66, 76 |
| **Verification** | Build-time Python assertion fails if jaraco.context < 6.1.0 |

---

## Section 2: Vendor-Dependent Vulnerabilities (Debian Base Image)

These vulnerabilities exist in the `python:3.11-slim` base image (Debian Bookworm). Remediation requires upstream Debian package updates, which are not yet available for all CVEs.

### OpenSSL Vulnerability Cluster (January 2026 Coordinated Release)

All OpenSSL CVEs below are part of the January 27, 2026 coordinated security release by OpenSSL. The vulnerabilities were discovered by AISLE Research using autonomous analysis.

**Critical Context:**
- All are related to PKCS#12 file processing
- PKCS#12 files typically contain private keys from **trusted sources**
- HealthPrep does NOT process untrusted PKCS#12 files
- FIPS modules are NOT affected (PKCS#12 is outside FIPS boundary)

#### CVE-2025-69419 - openssl

| Field | Value |
|-------|-------|
| **Severity** | HIGH (Inspector) / LOW (OpenSSL) |
| **CVSS 3.1 Score** | ~6.5 (estimated) |
| **Attack Vector** | Network (AV:N) |
| **Package** | openssl (Debian libssl3) |
| **Vulnerability Type** | Out-of-bounds write in `PKCS12_get_friendlyname()` UTF-8 conversion |
| **Impact** | Memory corruption, DoS. Limited: only triggers 1-byte write with maliciously crafted PKCS#12 files containing non-ASCII BMP code points |
| **Fixed Version** | OpenSSL 3.5.5 / 3.4.4 / 3.3.6 / 3.0.19 |
| **Debian Status** | **Pending** - Bookworm still ships OpenSSL 3.2.2 |
| **Status** | **ACCEPTED RISK** |

#### CVE-2025-69421 - openssl

| Field | Value |
|-------|-------|
| **Severity** | HIGH (Inspector) / LOW (OpenSSL) |
| **CVSS 3.1 Score** | ~6.5 (estimated) |
| **Attack Vector** | Network (AV:N) |
| **Package** | openssl (Debian libssl3) |
| **Vulnerability Type** | NULL pointer dereference in `PKCS12_item_decrypt_d2i_ex()` |
| **Impact** | DoS (crash only). Cannot escalate to code execution or memory disclosure |
| **Fixed Version** | OpenSSL 3.5.5 / 3.4.4 / 3.3.6 / 3.0.19 |
| **Debian Status** | **Pending** - Bookworm still ships OpenSSL 3.2.2 |
| **Status** | **ACCEPTED RISK** |

#### CVE-2025-11187 - openssl

| Field | Value |
|-------|-------|
| **Severity** | MEDIUM |
| **CVSS 3.1 Score** | **6.1** |
| **Attack Vector** | Network (AV:N) |
| **Package** | openssl (Debian libssl3) |
| **Vulnerability Type** | Stack buffer overflow or NULL pointer dereference during PKCS#12 MAC verification with PBMAC1 |
| **Impact** | DoS (crash), potentially arbitrary code execution depending on platform mitigations. Overflow length is attacker-controlled |
| **Affected Versions** | OpenSSL 3.6, 3.5, 3.4 only (not 3.3, 3.0, 1.1.1, 3.2.x) |
| **Fixed Version** | OpenSSL 3.6.1 / 3.5.5 / 3.4.4 |
| **Debian Status** | **Not Vulnerable** - Bookworm ships OpenSSL 3.2.2 which does not include PBMAC1 support |
| **Status** | **ACCEPTED RISK** |
| **Risk Acceptance Rationale** | Inspector flags this CVE based on package presence, but OpenSSL 3.2.x is not actually vulnerable per OpenSSL advisory. Documented as accepted risk for audit trail completeness. Verified via `openssl version` output: 3.2.2 |
| **Evidence** | OpenSSL advisory states "OpenSSL 3.3, 3.0, 1.1.1 are not affected (no PBMAC1 support)" - 3.2.x similarly lacks PBMAC1 |

#### CVE-2026-22795 - openssl

| Field | Value |
|-------|-------|
| **Severity** | MEDIUM (Inspector) / LOW (OpenSSL) |
| **CVSS 3.1 Score** | ~4.0 (estimated) |
| **Attack Vector** | Network (AV:N) |
| **Package** | openssl (Debian libssl3) |
| **Vulnerability Type** | Missing ASN1_TYPE validation in PKCS#12 parsing, type confusion → NULL pointer dereference |
| **Impact** | DoS (crash only). Pointer constrained to 0x00–0xFF, always unmapped memory on modern OSes |
| **Fixed Version** | OpenSSL 3.6.1 / 3.5.5 / 3.4.4 / 3.3.6 / 3.0.19 |
| **Debian Status** | **Pending** - Bookworm still ships OpenSSL 3.2.2 |
| **Status** | **ACCEPTED RISK** |

#### CVE-2025-69418 - openssl

| Field | Value |
|-------|-------|
| **Severity** | MEDIUM |
| **CVSS 3.1 Score** | ~5.0 (estimated) |
| **Attack Vector** | Network (AV:N) |
| **Package** | openssl (Debian libssl3) |
| **Vulnerability Type** | PKCS#12 processing issue |
| **Impact** | DoS |
| **Fixed Version** | OpenSSL 3.5.5 / 3.4.4 / 3.3.6 / 3.0.19 |
| **Debian Status** | **Pending** |
| **Status** | **ACCEPTED RISK** |

### CVE-2026-25210 - expat (libexpat1)

| Field | Value |
|-------|-------|
| **Severity** | MEDIUM |
| **CVSS 3.1 Score** | **6.9** |
| **CVSS Vector** | CVSS:3.1/AV:L/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:L |
| **Attack Vector** | Local (AV:L) |
| **Attack Complexity** | High (AC:H) |
| **EPSS Score** | 0.00005 (0.005% - Very Low) |
| **Exploit Available** | NO |
| **Package** | expat 2.7.1-2 (Debian) |
| **Vulnerability Type** | Integer overflow in `doContent` buffer size calculation |
| **Impact** | DoS, memory corruption when processing maliciously crafted XML |
| **Fixed Version** | Expat 2.7.4 |
| **Debian Status** | **NotAvailable** - No Debian 13 backport as of 2026-02-04 |
| **Status** | **ACCEPTED RISK** |
| **Risk Acceptance Date** | 2026-02-03 |
| **Risk Owner** | Mitchell Fusillo |
| **Evidence** | AWS Inspector finding ARN: `arn:aws:inspector2:us-east-2:179678238031:finding/764b48f83aa4bdc693496b415628ecaf` |

### CVE-2025-7709 - sqlite3

| Field | Value |
|-------|-------|
| **Severity** | INFORMATIONAL |
| **CVSS 3.1 Score** | N/A |
| **Package** | sqlite3 (Debian) |
| **Impact** | Informational-level issue |
| **Fixed Version** | NotAvailable |
| **Debian Status** | **Pending** |
| **Status** | **ACCEPTED RISK** |
| **Risk Acceptance Date** | 2026-02-04 |
| **Risk Owner** | Mitchell Fusillo |
| **Risk Acceptance Rationale** | Informational severity; SQLite not used for primary data storage (PostgreSQL is primary database) |

---

## Section 3: Risk Acceptance & Compensating Controls

### Risk Acceptance Rationale for Vendor-Dependent CVEs

All vendor-dependent OpenSSL and expat CVEs are accepted with the following justification:

1. **Attack Surface Limitation:**
   - HealthPrep does NOT process untrusted PKCS#12 files
   - HealthPrep does NOT parse untrusted XML with unknown encoding handlers
   - All PKCS#12 operations (if any) use internally-generated certificates
   - XML parsing is limited to FHIR resources from trusted Epic endpoints

2. **No Upstream Fix Available:**
   - Debian Bookworm (base image) has not released security updates for these CVEs
   - Switching base images (e.g., Alpine) would introduce significant regression risk
   - Python official images do not offer newer Debian versions with fixes

3. **Low Practical Exploitability:**
   - All OpenSSL CVEs require malicious PKCS#12 files from attackers
   - CVSS scores reflect theoretical risk, not HealthPrep's actual exposure
   - OpenSSL project rates most as "Low" severity despite Inspector's rating

### Compensating Controls Matrix

| Control | Description | CVEs Mitigated |
|---------|-------------|----------------|
| **Network Isolation** | Application runs in private VPC subnet; only ALB in public subnet | All network-based CVEs |
| **ALB TLS Termination** | TLS 1.2+ enforced at ALB; internal traffic is intra-VPC only | OpenSSL CVEs |
| **WAF Protection** | AWS WAF with managed rule sets blocks malicious payloads | All input-based CVEs |
| **Input Validation** | FHIR resources validated against R4 schemas before processing | expat CVE |
| **Trusted Sources Only** | PKCS#12 files never accepted from external sources | OpenSSL PKCS#12 CVEs |
| **Non-Root Container** | Application runs as `healthprep` user, not root | All privilege escalation CVEs |
| **Read-Only Filesystem** | ECS task configured with read-only root filesystem (recommended) | Path traversal CVEs |
| **Security Monitoring** | AWS Security Hub + GuardDuty for anomaly detection | All CVEs |
| **Container Image Scanning** | AWS Inspector continuous scanning with alerts | All CVEs |
| **Rapid Patching SLA** | Critical CVEs: 24 hours; High: 7 days; Medium: 30 days | All CVEs |

### Monitoring Plan for Accepted Risks

| Action | Frequency | Owner | Method |
|--------|-----------|-------|--------|
| Check Debian security tracker for openssl updates | Weekly | Mitchell Fusillo | https://security-tracker.debian.org/tracker/source-package/openssl |
| Check Debian security tracker for expat updates | Weekly | Mitchell Fusillo | https://security-tracker.debian.org/tracker/source-package/expat |
| Review AWS Inspector findings | Daily | Mitchell Fusillo | AWS Console or CLI |
| Re-evaluate base image options | Monthly | Mitchell Fusillo | Check Python Docker Hub for new secure images |
| Test alternative base images in staging | Quarterly | Mitchell Fusillo | Build and scan with Alpine/Slim variants |

---

## Section 4: Dockerfile Security Controls

The following security controls are implemented in the production Dockerfile:

1. **OS Package Updates:** `apt-get upgrade -y` applied in both build and production stages
2. **Python Package Upgrades:** pip, wheel, setuptools upgraded before and after requirements install
3. **CVE-Specific Patches:** Explicit upgrade of `wheel>=0.46.2` and `jaraco.context>=6.1.0`
4. **Build-Time Verification:** Python assertions fail build if security package versions are insufficient
5. **Non-Root User:** Application runs as `healthprep` user, not root
6. **Minimal Image:** Development files removed from production image
7. **Health Checks:** Container health endpoint for orchestration monitoring
8. **Version Logging:** OpenSSL and dpkg versions logged during build for audit trail

---

## Section 5: Verification & Evidence Collection

### Post-Deployment Verification Steps

1. Push Dockerfile changes to GitHub (`git push origin main`)
2. GitHub Actions builds and pushes new image to ECR
3. ECS deploys new task definition with updated image
4. AWS Inspector automatically rescans ECR image (15-30 minutes)
5. Verify findings via CLI:

```bash
# Check HIGH/MEDIUM findings
aws inspector2 list-findings --region us-east-2 \
  --filter-criteria '{"severity": [{"comparison": "EQUALS", "value": "HIGH"}, {"comparison": "EQUALS", "value": "MEDIUM"}]}' \
  --query 'findings[].{Title:title,Severity:severity,Status:status}' \
  --output table

# Check last scan time
aws inspector2 list-coverage --region us-east-2 \
  --filter-criteria '{"resourceType": [{"comparison": "EQUALS", "value": "AWS_ECR_CONTAINER_IMAGE"}]}' \
  --query 'coveredResources[].{Resource:resourceId,LastScanned:lastScannedAt}' \
  --output table
```

### Evidence Export for HITRUST Audit

```bash
# Export findings to S3 for HITRUST evidence
aws inspector2 create-findings-report --region us-east-2 \
  --report-format CSV \
  --s3-destination bucket=healthprep-security-evidence,keyPrefix=inspector/ \
  --filter-criteria '{"resourceType": [{"comparison": "EQUALS", "value": "AWS_ECR_CONTAINER_IMAGE"}]}'
```

---

## Section 6: Remediation History

| Date | Action | Performed By | Result |
|------|--------|--------------|--------|
| 2026-02-03 | Initial AWS Inspector scan | Mitchell Fusillo | 4 HIGH, 4 MEDIUM findings (8 unique CVEs) |
| 2026-02-03 | Dockerfile security updates | Mitchell Fusillo | Patched wheel, jaraco.context CVEs |
| 2026-02-03 | Risk acceptance for expat CVE | Mitchell Fusillo | Documented, no upstream fix |
| 2026-02-04 | Comprehensive CVE accountability review | Mitchell Fusillo | Full CVSS analysis, 8 unique CVEs reconciled against Inspector output |
| 2026-02-04 | Vendor-dependent CVE risk acceptance | Mitchell Fusillo | 6 OpenSSL/expat CVEs accepted with compensating controls |
| 2026-02-04 | ECR image cleanup and rescan | Mitchell Fusillo | Removed vulnerable images, only patched image (3dd1245) remains |
| 2026-02-04 | Inspector findings summary created | Mitchell Fusillo | 2 active findings (1 Medium, 1 Informational), 100% accountability |
| 2026-02-04 | CVE-2025-7709 (sqlite3) risk acceptance | Mitchell Fusillo | Informational severity, accepted with documentation |

---

## Section 7: Next Scheduled Actions

| Action | Target Date | Owner | Priority |
|--------|-------------|-------|----------|
| Verify Inspector findings post-deployment | After next GitHub push | Mitchell Fusillo | High |
| Export Inspector report to S3 | After verification | Mitchell Fusillo | Medium |
| Check Debian security tracker updates | 2026-02-11 | Mitchell Fusillo | Medium |
| Monthly vulnerability review | 2026-03-04 | Mitchell Fusillo | Medium |
| Quarterly base image evaluation | 2026-05-01 | Mitchell Fusillo | Low |

---

## Revision History

| Version | Date | Author | Changes |
|---------|------|--------|---------|
| 1.0 | 2026-02-03 | Mitchell Fusillo | Initial vulnerability remediation log |
| 2.0 | 2026-02-04 | Mitchell Fusillo | Comprehensive CVE accountability: added CVSS scores, attack vectors, compensating controls matrix, vendor-dependent classification, monitoring plan |
| 2.1 | 2026-02-04 | Mitchell Fusillo | Added CVE-2025-7709 (sqlite3), updated expat CVE with Inspector finding ARN and EPSS score, ECR cleanup verification, created inspector-findings-summary.md |
