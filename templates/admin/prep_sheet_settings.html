{% extends "base_admin.html" %}

{% block title %}Prep Sheet Settings{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2><i class="fas fa-file-medical"></i> Prep Sheet Generation Settings</h2>
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="{{ url_for('admin.dashboard') }}">Admin Dashboard</a></li>
                        <li class="breadcrumb-item active">Prep Sheet Settings</li>
                    </ol>
                </nav>
            </div>

            <div class="row">
                <div class="col-md-8">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">Document Cutoff Periods</h5>
                            <small class="text-muted">Configure how far back to include documents in prep sheets</small>
                        </div>
                        <div class="card-body">
                            <form method="POST">
                                {{ form.hidden_tag() }}
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            {{ form.labs_cutoff_months.label(class="form-label") }}
                                            {{ form.labs_cutoff_months(class="form-control") }}
                                            {% if form.labs_cutoff_months.errors %}
                                                <div class="text-danger small">
                                                    {% for error in form.labs_cutoff_months.errors %}
                                                        {{ error }}
                                                    {% endfor %}
                                                </div>
                                            {% endif %}
                                            <small class="form-text text-muted">Laboratory results to include in prep sheets</small>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            {{ form.imaging_cutoff_months.label(class="form-label") }}
                                            {{ form.imaging_cutoff_months(class="form-control") }}
                                            {% if form.imaging_cutoff_months.errors %}
                                                <div class="text-danger small">
                                                    {% for error in form.imaging_cutoff_months.errors %}
                                                        {{ error }}
                                                    {% endfor %}
                                                </div>
                                            {% endif %}
                                            <small class="form-text text-muted">Imaging studies to include in prep sheets</small>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            {{ form.consults_cutoff_months.label(class="form-label") }}
                                            {{ form.consults_cutoff_months(class="form-control") }}
                                            {% if form.consults_cutoff_months.errors %}
                                                <div class="text-danger small">
                                                    {% for error in form.consults_cutoff_months.errors %}
                                                        {{ error }}
                                                    {% endfor %}
                                                </div>
                                            {% endif %}
                                            <small class="form-text text-muted">Specialist consultation notes</small>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            {{ form.hospital_cutoff_months.label(class="form-label") }}
                                            {{ form.hospital_cutoff_months(class="form-control") }}
                                            {% if form.hospital_cutoff_months.errors %}
                                                <div class="text-danger small">
                                                    {% for error in form.hospital_cutoff_months.errors %}
                                                        {{ error }}
                                                    {% endfor %}
                                                </div>
                                            {% endif %}
                                            <small class="form-text text-muted">Hospital records and discharge summaries</small>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="d-flex justify-content-between">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save"></i> Save Settings
                                    </button>
                                    <a href="{{ url_for('admin.dashboard') }}" class="btn btn-secondary">
                                        <i class="fas fa-arrow-left"></i> Back to Dashboard
                                    </a>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">Current Settings</h5>
                        </div>
                        <div class="card-body">
                            <div class="setting-item mb-3">
                                <strong>Labs Cutoff:</strong>
                                <span class="badge bg-info">{{ settings.labs_cutoff_months or 12 }} months</span>
                            </div>
                            <div class="setting-item mb-3">
                                <strong>Imaging Cutoff:</strong>
                                <span class="badge bg-info">{{ settings.imaging_cutoff_months or 12 }} months</span>
                            </div>
                            <div class="setting-item mb-3">
                                <strong>Consults Cutoff:</strong>
                                <span class="badge bg-info">{{ settings.consults_cutoff_months or 12 }} months</span>
                            </div>
                            <div class="setting-item mb-3">
                                <strong>Hospital Records Cutoff:</strong>
                                <span class="badge bg-info">{{ settings.hospital_cutoff_months or 12 }} months</span>
                            </div>
                            
                            {% if settings.updated_at %}
                            <div class="mt-4">
                                <small class="text-muted">
                                    <i class="fas fa-clock"></i> Last updated: {{ settings.updated_at.strftime('%Y-%m-%d %H:%M') }}
                                </small>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="card mt-3">
                        <div class="card-header">
                            <h5 class="card-title mb-0">Information</h5>
                        </div>
                        <div class="card-body">
                            <p class="text-muted small">
                                <i class="fas fa-info-circle"></i>
                                These settings control how far back in time to look for relevant documents when generating prep sheets.
                            </p>
                            <p class="text-muted small">
                                Longer cutoff periods include more historical data but may make prep sheets longer and potentially less relevant.
                            </p>
                            <p class="text-muted small">
                                <strong>Recommended ranges:</strong><br>
                                • Labs: 6-12 months<br>
                                • Imaging: 12-24 months<br>
                                • Consults: 6-18 months<br>
                                • Hospital: 12-24 months
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}