{% extends "root_admin/base_root_admin.html" %}

{% block title %}Create Organization - Root Admin{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{{ url_for('root_admin.dashboard') }}">Dashboard</a></li>
                <li class="breadcrumb-item"><a href="{{ url_for('root_admin.organizations') }}">Organizations</a></li>
                <li class="breadcrumb-item active">Create Organization</li>
            </ol>
        </nav>
        
        <h1 class="mb-4">
            <i class="fas fa-plus-circle text-danger me-2"></i>Create Organization (Manual Billing)
        </h1>
    </div>
</div>

<div class="row">
    <div class="col-lg-8">
        <div class="alert alert-info">
            <i class="fas fa-info-circle me-2"></i>
            <strong>Enterprise Organization Creation</strong><br>
            This creates an organization with manual billing for custom pricing arrangements. 
            The organization admin will receive a welcome email to set their password and configure the system.
            Payment processing via Stripe will be disabled for this organization.
        </div>

        <form method="POST">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            
            <!-- Organization Details -->
            <div class="card root-admin-card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-building me-2"></i>Organization Details
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-12 mb-3">
                            <label for="org_name" class="form-label">Organization Name <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="org_name" name="org_name" required>
                            <div class="form-text">Unique identifier for the organization</div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="site" class="form-label">Site/Location</label>
                            <input type="text" class="form-control" id="site" name="site" placeholder="Main Campus, Downtown Clinic, etc.">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="specialty" class="form-label">Specialty</label>
                            <select class="form-control" id="specialty" name="specialty">
                                <option value="">Select specialty...</option>
                                <option value="Family Practice">Family Practice</option>
                                <option value="Internal Medicine">Internal Medicine</option>
                                <option value="Pediatrics">Pediatrics</option>
                                <option value="OB/GYN">OB/GYN</option>
                                <option value="Cardiology">Cardiology</option>
                                <option value="Endocrinology">Endocrinology</option>
                                <option value="Gastroenterology">Gastroenterology</option>
                                <option value="Multi-Specialty">Multi-Specialty</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="phone" class="form-label">Phone</label>
                            <input type="tel" class="form-control" id="phone" name="phone" placeholder="+1 (555) 123-4567">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="address" class="form-label">Address</label>
                            <textarea class="form-control" id="address" name="address" rows="2" placeholder="Organization address"></textarea>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Admin Contact -->
            <div class="card root-admin-card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-user-shield me-2"></i>Organization Admin
                    </h5>
                </div>
                <div class="card-body">
                    <div class="alert alert-info">
                        <i class="fas fa-envelope me-2"></i>
                        A welcome email will be sent to the admin with a password setup link.
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="contact_email" class="form-label">Admin Email <span class="text-danger">*</span></label>
                            <input type="email" class="form-control" id="contact_email" name="contact_email" required placeholder="admin@organization.com">
                            <div class="form-text">Welcome email will be sent here</div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="billing_email" class="form-label">Billing Email</label>
                            <input type="email" class="form-control" id="billing_email" name="billing_email" placeholder="billing@organization.com">
                            <div class="form-text">Leave blank to use admin email</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Epic FHIR Integration -->
            <div class="card root-admin-card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-link me-2"></i>Epic FHIR Integration
                    </h5>
                </div>
                <div class="card-body">
                    <div class="alert alert-secondary">
                        <i class="fas fa-info-circle me-2"></i>
                        Epic credentials can be configured now or later by the organization admin.
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="epic_client_id" class="form-label">Epic Client ID</label>
                            <input type="text" class="form-control" id="epic_client_id" name="epic_client_id" 
                                   placeholder="e57377e2-dfd5-4675-9659-...">
                            <div class="form-text">Optional - can be set during onboarding</div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="epic_client_secret" class="form-label">Epic Client Secret</label>
                            <input type="password" class="form-control" id="epic_client_secret" name="epic_client_secret" 
                                   placeholder="Client secret from Epic registration">
                            <div class="form-text">Optional - encrypted at rest</div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-8 mb-3">
                            <label for="epic_fhir_url" class="form-label">Epic FHIR URL</label>
                            <input type="url" class="form-control" id="epic_fhir_url" name="epic_fhir_url" 
                                   placeholder="https://fhir.epic.com/interconnect-fhir-oauth/api/FHIR/R4">
                            <div class="form-text">Full FHIR endpoint URL</div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="epic_environment" class="form-label">Environment</label>
                            <select class="form-select" id="epic_environment" name="epic_environment">
                                <option value="sandbox" selected>Sandbox</option>
                                <option value="production">Production</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- System Settings -->
            <div class="card root-admin-card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-cog me-2"></i>System Settings
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="max_users" class="form-label">Maximum Users</label>
                            <input type="number" class="form-control" id="max_users" name="max_users" 
                                   value="10" min="1" max="1000">
                            <div class="form-text">License limit for this organization</div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="display_name" class="form-label">Display Name</label>
                            <input type="text" class="form-control" id="display_name" name="display_name" 
                                   placeholder="Optional friendly name">
                            <div class="form-text">Optional branding override</div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox" id="custom_presets_enabled" name="custom_presets_enabled" checked>
                                <label class="form-check-label" for="custom_presets_enabled">
                                    Custom Presets Enabled
                                </label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox" id="auto_sync_enabled" name="auto_sync_enabled" checked>
                                <label class="form-check-label" for="auto_sync_enabled">
                                    Auto Sync Enabled
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Internal Notes -->
            <div class="card root-admin-card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-sticky-note me-2"></i>Internal Notes
                    </h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label for="notes" class="form-label">Notes</label>
                        <textarea class="form-control" id="notes" name="notes" rows="3" placeholder="Enterprise contract details, custom pricing, special requirements, etc."></textarea>
                        <div class="form-text">Internal tracking notes (not visible to organization)</div>
                    </div>
                </div>
            </div>
            
            <!-- Submit -->
            <div class="d-flex justify-content-between">
                <a href="{{ url_for('root_admin.organizations') }}" class="btn btn-secondary">
                    <i class="fas fa-arrow-left me-1"></i>Cancel
                </a>
                <button type="submit" class="btn btn-danger">
                    <i class="fas fa-plus me-1"></i>Create Organization
                </button>
            </div>
        </form>
    </div>
    
    <!-- Help Sidebar -->
    <div class="col-lg-4">
        <div class="card bg-light">
            <div class="card-header">
                <h6 class="mb-0"><i class="fas fa-info-circle me-1"></i> What Happens Next?</h6>
            </div>
            <div class="card-body">
                <ol class="mb-0">
                    <li class="mb-2">Organization is created with manual billing status</li>
                    <li class="mb-2">Admin receives welcome email with password setup link</li>
                    <li class="mb-2">Admin configures users, Epic credentials, and screenings</li>
                    <li class="mb-2">Organization joins approval queue</li>
                    <li class="mb-2">Root admin approves when ready (no Stripe subscription)</li>
                    <li class="mb-0">System activates without payment processing</li>
                </ol>
            </div>
        </div>

        <div class="card bg-warning bg-opacity-10 border-warning mt-3">
            <div class="card-body">
                <h6 class="text-warning mb-2">
                    <i class="fas fa-exclamation-triangle me-1"></i> Important
                </h6>
                <p class="mb-0 small">
                    Manual billing organizations bypass Stripe entirely. 
                    You'll need to handle billing and payment collection through separate channels.
                </p>
            </div>
        </div>
    </div>
</div>
{% endblock %}