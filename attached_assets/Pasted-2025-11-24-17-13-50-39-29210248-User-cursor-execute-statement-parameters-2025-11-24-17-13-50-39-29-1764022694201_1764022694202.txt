2025-11-24 17:13:50.39
29210248
User
cursor.execute(statement, parameters)
2025-11-24 17:13:50.39
29210248
User
File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 944, in do_execute
2025-11-24 17:13:50.39
29210248
User
File "", line 2, in _prepare_impl
2025-11-24 17:13:50.39
29210248
User
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2025-11-24 17:13:50.39
29210248
User
File "", line 2, in commit
2025-11-24 17:13:50.39
29210248
User
File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4480, in _flush
2025-11-24 17:13:50.39
29210248
User
flush_context.execute()
2025-11-24 17:13:50.39
29210248
User
File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
2025-11-24 17:13:50.39
29210248
User
File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/flask/app.py", line 1511, in wsgi_app
2025-11-24 17:13:50.39
29210248
User
self._prepare_impl()
2025-11-24 17:13:50.39
29210248
User
File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 137, in _go
2025-11-24 17:13:50.39
29210248
User
with util.safe_reraise():
2025-11-24 17:13:50.39
29210248
User
Traceback (most recent call last):
2025-11-24 17:13:50.39
29210248
User
raise exc_value.with_traceback(exc_tb)
2025-11-24 17:13:50.39
29210248
User
rv = self.dispatch_request()
2025-11-24 17:14:12.90
29210248
User
INFO:services.email_service:Email sent successfully to mitchfuse98@test.org: HealthPrep - Organization Application Status
2025-11-24 17:14:12.90
29210248
User
INFO:routes.org_approval_routes:Archiving Stripe customer cus_TRslPCOjNfZUsK for rejected org 7
2025-11-24 17:14:13.15
29210248
User
INFO:stripe:message='Request to Stripe api' method=post url=https://api.stripe.com/v1/customers/cus_TRslPCOjNfZUsK
2025-11-24 17:14:13.42
29210248
User
INFO:stripe:message='Stripe API response' path=https://api.stripe.com/v1/customers/cus_TRslPCOjNfZUsK response_code=200
2025-11-24 17:14:14.10
29210248
User
ERROR:routes.org_approval_routes:Error rejecting organization 7: (psycopg2.errors.ForeignKeyViolation) insert or update on table "admin_logs" violates foreign key constraint "admin_logs_org_id_fkey"
2025-11-24 17:14:14.10
29210248
User
DETAIL: Key (org_id)=(0) is not present in table "organizations".
2025-11-24 17:14:14.10
29210248
User
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-11-24 17:14:14.10
29210248
User
[SQL: INSERT INTO admin_logs (timestamp, event_type, user_id, org_id, ip_address, patient_id, resource_type, resource_id, action_details, data, session_id, user_agent) VALUES (%(timestamp)s, %(event_type)s, %(user_id)s, %(org_id)s, %(ip_address)s, %(patient_id)s, %(resource_type)s, %(resource_id)s, %(action_details)s, %(data)s::JSON, %(session_id)s, %(user_agent)s) RETURNING admin_logs.id]
2025-11-24 17:14:14.10
29210248
User
[parameters: {'timestamp': datetime.datetime(2025, 11, 24, 22, 14, 14, 63501), 'event_type': 'organization_rejected_deleted', 'user_id': 5, 'org_id': 0, 'ip_address': '34.44.227.96', 'patient_id': None, 'resource_type': None, 'resource_id': None, 'action_details': None, 'data': '{"organization_name": "default 3", "organization_id": 7, "rejected_by": "rootadmin", "rejection_reason": "a", "users_deleted": 1, "audit_logs_preserved": 0, "description": "Rejected and deleted organization: default 3 (1 users, 0 audit logs preserved). Reason: a"}', 'session_id': None, 'user_agent': None}]