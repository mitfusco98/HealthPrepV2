[2025-09-17 18:03:38 +0000] [7156] [INFO] Starting gunicorn 23.0.0
[2025-09-17 18:03:38 +0000] [7156] [INFO] Listening at: http://0.0.0.0:5000 (7156)
[2025-09-17 18:03:38 +0000] [7156] [INFO] Using worker: sync
[2025-09-17 18:03:38 +0000] [7167] [INFO] Booting worker with pid: 7167
[2025-09-17 18:03:39 +0000] [7156] [INFO] Handling signal: winch
[2025-09-17 18:03:39 +0000] [7156] [INFO] Handling signal: winch
[2025-09-17 18:03:39 +0000] [7156] [INFO] Handling signal: winch
[2025-09-17 18:03:39 +0000] [7156] [INFO] Handling signal: winch
[2025-09-17 18:03:39 +0000] [7156] [INFO] Handling signal: winch
[2025-09-17 18:03:39 +0000] [7156] [INFO] Handling signal: winch
[2025-09-17 18:03:39 +0000] [7156] [INFO] Handling signal: winch
[2025-09-17 18:03:39 +0000] [7156] [INFO] Handling signal: winch
[2025-09-17 18:03:39 +0000] [7156] [INFO] Handling signal: winch
[2025-09-17 18:03:39 +0000] [7156] [INFO] Handling signal: winch
[2025-09-17 18:03:39 +0000] [7156] [INFO] Handling signal: winch
[2025-09-17 18:03:39 +0000] [7156] [INFO] Handling signal: winch
[2025-09-17 18:03:39 +0000] [7156] [INFO] Handling signal: winch
[2025-09-17 18:03:39 +0000] [7156] [INFO] Handling signal: winch
[2025-09-17 18:03:39 +0000] [7156] [INFO] Handling signal: winch
[2025-09-17 18:03:39 +0000] [7156] [INFO] Handling signal: winch
[2025-09-17 18:03:39 +0000] [7156] [INFO] Handling signal: winch
[2025-09-17 18:03:39 +0000] [7156] [INFO] Handling signal: winch
[2025-09-17 18:03:39 +0000] [7156] [INFO] Handling signal: winch
[2025-09-17 18:03:39 +0000] [7156] [INFO] Handling signal: winch
[2025-09-17 18:03:39 +0000] [7156] [INFO] Handling signal: winch
[2025-09-17 18:03:39 +0000] [7156] [INFO] Handling signal: winch
[2025-09-17 18:03:39 +0000] [7156] [INFO] Handling signal: winch
[2025-09-17 18:03:39 +0000] [7156] [INFO] Handling signal: winch
[2025-09-17 18:03:39 +0000] [7156] [INFO] Handling signal: winch
Using PostgreSQL database: ep-raspy-heart-aep9yhc2.c-2.us-east-2.aws.neon.tech
[2025-09-17 18:03:39 +0000] [7156] [INFO] Handling signal: winch
[2025-09-17 18:03:39 +0000] [7156] [INFO] Handling signal: winch
[2025-09-17 18:03:39 +0000] [7156] [INFO] Handling signal: winch
[2025-09-17 18:03:39 +0000] [7156] [INFO] Handling signal: winch
[2025-09-17 18:03:39 +0000] [7156] [INFO] Handling signal: winch
[2025-09-17 18:03:39 +0000] [7156] [INFO] Handling signal: winch
[2025-09-17 18:03:39 +0000] [7156] [INFO] Handling signal: winch
[2025-09-17 18:03:39 +0000] [7156] [INFO] Handling signal: winch
[2025-09-17 18:03:39 +0000] [7156] [INFO] Handling signal: winch
[2025-09-17 18:03:39 +0000] [7156] [INFO] Handling signal: winch
[2025-09-17 18:03:39 +0000] [7156] [INFO] Handling signal: winch
[2025-09-17 18:03:39 +0000] [7156] [INFO] Handling signal: winch
[2025-09-17 18:03:39 +0000] [7156] [INFO] Handling signal: winch
INFO:app:Database tables created successfully
INFO:app:Startup document processing disabled for faster boot times (set STARTUP_PROCESS_DOCS=true to enable)
INFO:routes.oauth_routes:=== EPIC OAUTH AUTHORIZE DEBUG ===
INFO:routes.oauth_routes:Current user ID: 1
INFO:routes.oauth_routes:Current user username: admin
INFO:routes.oauth_routes:Current user org_id: 1
INFO:routes.oauth_routes:Current user organization object: <Organization Default Organization>
INFO:routes.oauth_routes:Session epic_org_id: None
INFO:routes.oauth_routes:Organization ID: 1
INFO:routes.oauth_routes:Organization name: Default Organization
INFO:routes.oauth_routes:Organization epic_client_id: e57377e2-dfd5-4675-9659-58c33aa67b3f
INFO:routes.oauth_routes:================================
INFO:routes.oauth_routes:OAuth redirect URI: https://55ab1b06-006d-47ec-9b73-b827f4e0f641-00-1fje9legmrd1y.riker.replit.dev/oauth/epic-callback
INFO:routes.oauth_routes:Epic client ID: e57377e2-dfd5-4675-9659-58c33aa67b3f
INFO:routes.oauth_routes:Epic auth URL: https://fhir.epic.com/interconnect-fhir-oauth/oauth2/authorize
INFO:emr.fhir_client:Epic OAuth Parameters:
INFO:emr.fhir_client:  response_type: code
INFO:emr.fhir_client:  client_id: e57377e2-dfd5-4675-9659-58c33aa67b3f
INFO:emr.fhir_client:  redirect_uri: https://55ab1b06-006d-47ec-9b73-b827f4e0f641-00-1fje9legmrd1y.riker.replit.dev/oauth/epic-callback
INFO:emr.fhir_client:  scope: openid fhirUser patient/Patient.read patient/Condition.read patient/Observation.read patient/DocumentReference.read patient/Encounter.read user/Patient.read user/Condition.read user/Observation.read user/DocumentReference.read user/Encounter.read
INFO:emr.fhir_client:  aud: https://fhir.epic.com/interconnect-fhir-oauth/api/FHIR/R4/
INFO:emr.fhir_client:  state: lBxwP8J0Z4Jv0GOFxNbWk6P-b5tb-WeIpQ9Ox2_bJTI
INFO:emr.fhir_client:Generated Epic authorization URL: https://fhir.epic.com/interconnect-fhir-oauth/oauth2/authorize?response_type=code&client_id=e57377e2-dfd5-4675-9659-58c33aa67b3f&redirect_uri=https%3A%2F%2F55ab1b06-006d-47ec-9b73-b827f4e0f641-00-1fje9legmrd1y.riker.replit.dev%2Foauth%2Fepic-callback&scope=openid+fhirUser+patient%2FPatient.read+patient%2FCondition.read+patient%2FObservation.read+patient%2FDocumentReference.read+patient%2FEncounter.read+user%2FPatient.read+user%2FCondition.read+user%2FObservation.read+user%2FDocumentReference.read+user%2FEncounter.read&aud=https%3A%2F%2Ffhir.epic.com%2Finterconnect-fhir-oauth%2Fapi%2FFHIR%2FR4%2F&state=lBxwP8J0Z4Jv0GOFxNbWk6P-b5tb-WeIpQ9Ox2_bJTI
INFO:routes.oauth_routes:Starting Epic OAuth flow for organization 1
INFO:routes.oauth_routes:=== Epic OAuth Callback Debug ===
INFO:routes.oauth_routes:Request URL: https://55ab1b06-006d-47ec-9b73-b827f4e0f641-00-1fje9legmrd1y.riker.replit.dev/oauth/epic-callback?code=eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOiJ1cm46b2lkOjEuMi44NDAuMTE0MzUwLjEuMTMuMC4xLjcuMy42ODg4ODQuMTAwIiwiY2xpZW50X2lkIjoiZTU3Mzc3ZTItZGZkNS00Njc1LTk2NTktNThjMzNhYTY3YjNmIiwiZXBpYy5lY2kiOiJ1cm46ZXBpYzpPcGVuLkVwaWMtY3VycmVudCIsImVwaWMubWV0YWRhdGEiOiJxTkdocmQ3VjN2d0hzTEVyMWlzbFVkdzRFSXR4b29yUm5qYlRPVDB2TDdmNWU5OUZSWDVXTnhpbHVyMFV0QlRWR1YwaDNoQ3pyUUJoVVZPY25JUUVycHpuOTYyUGVUc0JtS2s5WTA3dUVvQUw5aGpOWW5DSXk5VHROYmhMbjFQLSIsImVwaWMudG9rZW50eXBlIjoiY29kZSIsImV4cCI6MTc1ODEzMjgwMCwiaWF0IjoxNzU4MTMyNTAwLCJpc3MiOiJ1cm46b2lkOjEuMi44NDAuMTE0MzUwLjEuMTMuMC4xLjcuMy42ODg4ODQuMTAwIiwianRpIjoiNTE4MzhlMjktMmM5ZC00M2IzLWI3YWEtYWZlYWQwMjkwN2EzIiwibmJmIjoxNzU4MTMyNTAwLCJzdWIiOiJlNmF3Ni1SSnVLTzJtYnFqbGVLdmdWUTMifQ.mmIurVWqKelFukhYdhqOjoDVl0PqZtnYPG7s_w1vVxiADwWwkQ9LgvuSeftx2lP-H8SyulZp6uomAoiKnGIK_LyMOFDidlw97_WrVTRjsZT1vZdwqOt6bXEtH1Iv8lwyiyTNODiyhUnyxmqImOOcBkXEbiAanNJKtcyvBAwnXSO327FVHckDCPSDsWTdgdhWETYuuyA1MBR5jruKGs4EPzYzWGHicBN_cG_3sdpFOqJ2wz4bq1kPUdUtuvMUxHGmmkHR1VawbGN4HkvwwjPou4DjP-nffTELsN8Ab95fmzqltMugEoqTXlcXNwZEI4Sp3HzFvCgwxuhtumxWMJto1A&state=lBxwP8J0Z4Jv0GOFxNbWk6P-b5tb-WeIpQ9Ox2_bJTI
INFO:routes.oauth_routes:Request method: GET
INFO:routes.oauth_routes:Request headers: {'Host': '55ab1b06-006d-47ec-9b73-b827f4e0f641-00-1fje9legmrd1y.riker.replit.dev', 'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Replit/1.0.14 Chrome/124.0.6367.119 Electron/30.0.3 Safari/537.36', 'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7', 'Accept-Encoding': 'gzip, deflate, br', 'Accept-Language': 'en-US', 'Cookie': 'session=.eJw1jk9LA0EMxb_Lnl3J_M2kRw9Ke7AVCgUvy2QmQ5daW3anWhC_u1NFCIEk7738vrqhTDLvu0WdLnLXDWPuFp1TnJBysckToBhEEzwHsM4bzcqiL8ZCcqYghMQmacFAIVm2NikyxpB1JRYQGyNpBG8UM3hky5yzQcXOtaZCwBxjAm0gh-IwF_Ikpmsgl1mmPxrVxjRPZaing7y3BWP24cZSBD3HaFEcF0_tqYuFIQmRBl2aT85jGuKl7oc6HmWu8XhuAe3oeqBe4VaFBdzqPjilyP5bTr-epq_S9G8P189NWMGrXX3A0_rx-sy7g9_07Cr3O1meX2h91QOvtsvu-weP02IQ.aMr5CA.fqkme8ox_3lh7BUbP6KTFhS9_SE', 'Referer': 'https://fhir.epic.com/', 'Sec-Fetch-Dest': 'document', 'Sec-Fetch-Mode': 'navigate', 'Sec-Fetch-Site': 'cross-site', 'Sec-Fetch-User': '?1', 'Upgrade-Insecure-Requests': '1', 'X-Forwarded-For': '98.1.77.99, 10.81.4.32', 'X-Forwarded-Proto': 'https', 'X-Replit-User-Bio': '', 'X-Replit-User-Id': '', 'X-Replit-User-Name': '', 'X-Replit-User-Profile-Image': '', 'X-Replit-User-Roles': '', 'X-Replit-User-Teams': '', 'X-Replit-User-Url': ''}
INFO:routes.oauth_routes:Query parameters received:
INFO:routes.oauth_routes:  - code: <present>
INFO:routes.oauth_routes:  - state: <present>
INFO:routes.oauth_routes:  - error: None
INFO:routes.oauth_routes:  - error_description: None
INFO:routes.oauth_routes:  - all query args: {'code': 'eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOiJ1cm46b2lkOjEuMi44NDAuMTE0MzUwLjEuMTMuMC4xLjcuMy42ODg4ODQuMTAwIiwiY2xpZW50X2lkIjoiZTU3Mzc3ZTItZGZkNS00Njc1LTk2NTktNThjMzNhYTY3YjNmIiwiZXBpYy5lY2kiOiJ1cm46ZXBpYzpPcGVuLkVwaWMtY3VycmVudCIsImVwaWMubWV0YWRhdGEiOiJxTkdocmQ3VjN2d0hzTEVyMWlzbFVkdzRFSXR4b29yUm5qYlRPVDB2TDdmNWU5OUZSWDVXTnhpbHVyMFV0QlRWR1YwaDNoQ3pyUUJoVVZPY25JUUVycHpuOTYyUGVUc0JtS2s5WTA3dUVvQUw5aGpOWW5DSXk5VHROYmhMbjFQLSIsImVwaWMudG9rZW50eXBlIjoiY29kZSIsImV4cCI6MTc1ODEzMjgwMCwiaWF0IjoxNzU4MTMyNTAwLCJpc3MiOiJ1cm46b2lkOjEuMi44NDAuMTE0MzUwLjEuMTMuMC4xLjcuMy42ODg4ODQuMTAwIiwianRpIjoiNTE4MzhlMjktMmM5ZC00M2IzLWI3YWEtYWZlYWQwMjkwN2EzIiwibmJmIjoxNzU4MTMyNTAwLCJzdWIiOiJlNmF3Ni1SSnVLTzJtYnFqbGVLdmdWUTMifQ.mmIurVWqKelFukhYdhqOjoDVl0PqZtnYPG7s_w1vVxiADwWwkQ9LgvuSeftx2lP-H8SyulZp6uomAoiKnGIK_LyMOFDidlw97_WrVTRjsZT1vZdwqOt6bXEtH1Iv8lwyiyTNODiyhUnyxmqImOOcBkXEbiAanNJKtcyvBAwnXSO327FVHckDCPSDsWTdgdhWETYuuyA1MBR5jruKGs4EPzYzWGHicBN_cG_3sdpFOqJ2wz4bq1kPUdUtuvMUxHGmmkHR1VawbGN4HkvwwjPou4DjP-nffTELsN8Ab95fmzqltMugEoqTXlcXNwZEI4Sp3HzFvCgwxuhtumxWMJto1A', 'state': 'lBxwP8J0Z4Jv0GOFxNbWk6P-b5tb-WeIpQ9Ox2_bJTI'}
INFO:routes.oauth_routes:Session state: lBxwP8J0Z4Jv0GOFxNbWk6P-b5tb-WeIpQ9Ox2_bJTI
INFO:routes.oauth_routes:Session user: True
INFO:routes.oauth_routes:================================
INFO:routes.oauth_routes:=== EPIC OAUTH CALLBACK USER DEBUG ===
INFO:routes.oauth_routes:Callback current user ID: 1
INFO:routes.oauth_routes:Callback current user username: admin
INFO:routes.oauth_routes:Callback current user org_id: 1
INFO:routes.oauth_routes:Callback current user organization object: <Organization Default Organization>
INFO:routes.oauth_routes:Callback Organization ID: 1
INFO:routes.oauth_routes:Callback Organization name: Default Organization
INFO:routes.oauth_routes:Callback Organization epic_client_id: e57377e2-dfd5-4675-9659-58c33aa67b3f
INFO:routes.oauth_routes:=======================================
INFO:routes.oauth_routes:Token exchange - redirect URI: https://55ab1b06-006d-47ec-9b73-b827f4e0f641-00-1fje9legmrd1y.riker.replit.dev/oauth/epic-callback
INFO:routes.oauth_routes:Token exchange - client ID: e57377e2-dfd5-4675-9659-58c33aa67b3f
INFO:routes.oauth_routes:Token exchange - token URL: https://fhir.epic.com/interconnect-fhir-oauth/oauth2/token
INFO:emr.fhir_client:Token exchange request:
INFO:emr.fhir_client:  - URL: https://fhir.epic.com/interconnect-fhir-oauth/oauth2/token
INFO:emr.fhir_client:  - client_id: e57377e2-dfd5-4675-9659-58c33aa67b3f
INFO:emr.fhir_client:  - redirect_uri: https://55ab1b06-006d-47ec-9b73-b827f4e0f641-00-1fje9legmrd1y.riker.replit.dev/oauth/epic-callback
INFO:emr.fhir_client:  - grant_type: authorization_code
INFO:emr.fhir_client:  - code: <present>
INFO:emr.fhir_client:Token exchange response:
INFO:emr.fhir_client:  - status_code: 200
INFO:emr.fhir_client:  - headers: {'Cache-Control': 'no-cache, no-store,no-store', 'Pragma': 'no-cache', 'Content-Type': 'application/json; charset=utf-8', 'Expires': '-1', 'Set-Cookie': 'ASP.NET_SessionId=wizp1ru04o1lo4x5rldswga1; path=/Interconnect-fhir-oauth; secure; HttpOnly; SameSite=Lax, EpicPersistenceCookie=!KGoYzEmN+n2Gqhlc5iqg712Vrh0WW5QpGGRQeL2iOZPSkRg7BjX7lyDY//QXkoZTCX5QtDs0BYYoSFc=; path=/; Httponly; Secure', 'ServerMetrics': '{"BlockReads":16,"BlockWrites":2,"BlocksAllocated":0,"DBTime":36,"DatabaseCPUTime":32,"ECFNetworkTime":1,"ECFRequestCount":0,"ECFRequestTime":37,"GREF":2175,"JournalEntries":1,"LockWait":0.04,"LocksFailed":0,"LocksGranted":0,"MCommands":42499,"MemoryDifference":0,"NetworkCacheMisses":0,"NetworkUpdates":0,"WorkflowEventBlockReads":16,"WorkflowEventDBTime":36,"WorkflowEventECFNetworkTime":0,"WorkflowEventECFRequestCount":0,"WorkflowEventGREF":2175}', 'Strict-Transport-Security': 'max-age=31536000; includeSubDomains', 'X-Frame-Options': 'sameorigin', 'Access-Control-Allow-Headers': 'origin, authorization, accept, content-type, x-requested-with, prefer, Epic-User-ID, Epic-User-IDType, Epic-Client-ID, soapaction, Epic-MyChartUser-ID, Epic-MyChartUser-IDType', 'Access-Control-Allow-Methods': 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS', 'Access-Control-Allow-Origin': '*', 'Access-Control-Allow-Credentials': 'true', 'Date': 'Wed, 17 Sep 2025 18:08:21 GMT', 'Content-Length': '3386'}
INFO:emr.fhir_client:Successfully exchanged authorization code for Epic access token
INFO:routes.oauth_routes:Epic OAuth flow completed successfully for organization 1
ERROR:routes.screening_routes:Screening list error: name 'List' is not defined
ERROR:routes.screening_routes:Error loading screening types: name 'List' is not defined
INFO:flask_wtf.csrf:The CSRF token is missing.
ERROR:routes.screening_routes:Screening list error: name 'List' is not defined