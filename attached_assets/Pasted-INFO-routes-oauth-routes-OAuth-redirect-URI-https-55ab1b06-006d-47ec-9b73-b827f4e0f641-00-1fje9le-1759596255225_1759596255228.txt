INFO:routes.oauth_routes:OAuth redirect URI: https://55ab1b06-006d-47ec-9b73-b827f4e0f641-00-1fje9legmrd1y.riker.replit.dev/oauth/epic-callback
INFO:routes.oauth_routes:Epic client ID: e57377e2-dfd5-4675-9659-58c33aa67b3f
INFO:routes.oauth_routes:Epic auth URL: https://fhir.epic.com/interconnect-fhir-oauth/oauth2/authorize
INFO:services.epic_session_cleanup:Preparing for scope change - org: 1, scopes: ['openid', 'fhirUser', 'launch/patient', 'patient/Patient.read', 'patient/Observation.read', 'patient/Condition.read', 'patient/DocumentReference.read']
INFO:services.epic_session_cleanup:Scope changes detected for org 1:
INFO:services.epic_session_cleanup:  Added scopes: ['patient/Condition.read', 'patient/DocumentReference.read', 'patient/Observation.read', 'patient/Patient.read', 'launch/patient']
INFO:services.epic_session_cleanup:  Removed scopes: ['user/Binary.read', 'user/Observation.read', 'user/Patient.read', 'user/CarePlan.read', 'user/Goal.read', 'user/Condition.read', 'user/List.read', 'user/DiagnosticReport.read', 'offline_access', 'user/AllergyIntolerance.read', 'user/Appointment.read', 'user/DocumentReference.read', 'user/Encounter.read', 'user/Procedure.read']
INFO:services.epic_session_cleanup:Starting Epic session cleanup for org_id: 1
INFO:services.epic_session_cleanup:Epic session cleanup completed: {'session_keys_cleared': ['epic_access_token', 'epic_refresh_token', 'epic_token_expires', 'epic_token_scopes', 'epic_patient_id', 'epic_org_id', 'epic_scope_requested'], 'database_tokens_cleared': True, 'organization_status_reset': True, 'conflicts_resolved': 1, 'success': True, 'message': 'Epic sessions cleared successfully'}
INFO:routes.oauth_routes:Scope changes detected for org 1, session cleanup performed
INFO:emr.fhir_client:Epic OAuth Parameters:
INFO:emr.fhir_client:  response_type: code
INFO:emr.fhir_client:  client_id: e57377e2-dfd5-4675-9659-58c33aa67b3f
INFO:emr.fhir_client:  redirect_uri: https://55ab1b06-006d-47ec-9b73-b827f4e0f641-00-1fje9legmrd1y.riker.replit.dev/oauth/epic-callback
INFO:emr.fhir_client:  scope: openid fhirUser patient/Patient.read patient/Condition.read patient/Observation.read patient/DocumentReference.read patient/Encounter.read patient/Appointment.read user/Patient.read user/Condition.read user/Observation.read user/DocumentReference.read user/Encounter.read
INFO:emr.fhir_client:  aud: https://fhir.epic.com/interconnect-fhir-oauth/api/FHIR/R4/
INFO:emr.fhir_client:  state: 8mKLUty_pu65YgSf08Nus4ipVHV3DIdXYaO8Um1hUK0
INFO:emr.fhir_client:Generated Epic authorization URL: https://fhir.epic.com/interconnect-fhir-oauth/oauth2/authorize?response_type=code&client_id=e57377e2-dfd5-4675-9659-58c33aa67b3f&redirect_uri=https%3A%2F%2F55ab1b06-006d-47ec-9b73-b827f4e0f641-00-1fje9legmrd1y.riker.replit.dev%2Foauth%2Fepic-callback&scope=openid+fhirUser+patient%2FPatient.read+patient%2FCondition.read+patient%2FObservation.read+patient%2FDocumentReference.read+patient%2FEncounter.read+patient%2FAppointment.read+user%2FPatient.read+user%2FCondition.read+user%2FObservation.read+user%2FDocumentReference.read+user%2FEncounter.read&aud=https%3A%2F%2Ffhir.epic.com%2Finterconnect-fhir-oauth%2Fapi%2FFHIR%2FR4%2F&state=8mKLUty_pu65YgSf08Nus4ipVHV3DIdXYaO8Um1hUK0
INFO:routes.oauth_routes:Starting Epic OAuth flow for organization 1
INFO:werkzeug:10.81.0.121 - - [04/Oct/2025 16:42:04] "GET /oauth/epic-authorize HTTP/1.1" 302 -
INFO:routes.oauth_routes:=== Epic OAuth Callback Debug ===
INFO:routes.oauth_routes:Request URL: https://55ab1b06-006d-47ec-9b73-b827f4e0f641-00-1fje9legmrd1y.riker.replit.dev/oauth/epic-callback?code=eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOiJ1cm46b2lkOjEuMi44NDAuMTE0MzUwLjEuMTMuMC4xLjcuMy42ODg4ODQuMTAwIiwiY2xpZW50X2lkIjoiZTU3Mzc3ZTItZGZkNS00Njc1LTk2NTktNThjMzNhYTY3YjNmIiwiZXBpYy5lY2kiOiJ1cm46ZXBpYzpPcGVuLkVwaWMtY3VycmVudCIsImVwaWMubWV0YWRhdGEiOiIyeHI3NVpmSG1DWG55YnJobWJWMWszd1JjUE43Z3RjX0kxQjVRUEtXLVVYZ1IxWE9YSzBtX3BLbDMzLTdlbXI2NDNCRFppcEZNbF9hdTQ0dW1VUno1elgybV9yM01XSzR0VWgweVh6RVRoM2NybllkaFZoUkZIcjFqSXVrZ19SUiIsImVwaWMudG9rZW50eXBlIjoiY29kZSIsImV4cCI6MTc1OTU5NjQzNywiaWF0IjoxNzU5NTk2MTM3LCJpc3MiOiJ1cm46b2lkOjEuMi44NDAuMTE0MzUwLjEuMTMuMC4xLjcuMy42ODg4ODQuMTAwIiwianRpIjoiYmIwM2U4NWYtZTZlYy00NDAwLTllZWQtOTg4OGU2ODA5NDVjIiwibmJmIjoxNzU5NTk2MTM3LCJzdWIiOiJlNmF3Ni1SSnVLTzJtYnFqbGVLdmdWUTMifQ.ruLbnFLFz4PlqKWD-Qws4KinUgZQS-ZZOYTriIICYR2eWoHES-79UegZQg2oBqNDBtVsM3A3PAJ91meDZ-Tm8tO6eDDjK8xPMk0HdOIMmhw-ovEsWwP6lUfBPA_Q3stsaJjd0Et91L_B-arrGjVWNngajSFFam5NqV2Pqkl6QqMPadJ4oXDfWmIvxH98Y-PSi-Ij-WOFt4GYpMxUjiZF0s42WIruq_nBPM4Z2YtoV-PYltnT2hgYWt1efhEC6dlJrvqd6muQ4MIWbBLTPuq5ieMVE7vQEuRxVG30B_46CYr-b0y5IXaQovKvkcXmP_y1o9yyBtP_Yo5-f4t7xmWL4Q&state=8mKLUty_pu65YgSf08Nus4ipVHV3DIdXYaO8Um1hUK0
INFO:routes.oauth_routes:Request method: GET
INFO:routes.oauth_routes:Request headers: {'Host': '55ab1b06-006d-47ec-9b73-b827f4e0f641-00-1fje9legmrd1y.riker.replit.dev', 'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Replit/1.0.14 Chrome/124.0.6367.119 Electron/30.0.3 Safari/537.36', 'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7', 'Accept-Encoding': 'gzip, deflate, br', 'Accept-Language': 'en-US', 'Cookie': 'session=.eJyFUl1v1TAM_StVnveRpEnT9A2xB9AQFwF3YkJT5TjOGnFvWtoUgab9d7LtDqRp054cH_vYzrFvWB92sAy0sO77DatyMSymMLIjtnmz5qFacJyoot8TJE--ymMVE-5WT101QY6U8unbMfmY45hOZgJ_9A8_G3Hdl8dnCjRTQnoS37iF5l_wDPPTgz2gO1gTDqeHILu6vToqY8-0DKzL80rFi551TKCvNQVbO15jCzy4xqMRTRBGSA3GigbbALbmUnmtfc2tECStEhJAB0u1N85K4JJ7ZS0XziiHwbTQaq8Fb7mExqAzVoEMxngjOEiHaIO561Y069fypcM0xcVlDn0ef1AqgGmc8c7WqFWZDwMhR-6cUD4Yj6Bca6X2igqPpog9FPn7HPe0ZNhPpYDkUh8LfszVV9F0SnZcnTRSNkI-UsZ7TsnPVPLb_fmHbf7TT2ujL6-_BN5-XBcVp4t3F_XZe__tEjbtdi-G7Tl_LHC_7R4HSNf0am_dcPO_9wN1pp9rIdGdAsVP0VdhiPO2yPJkj88u-8XbeOHYXrk1dvsXpcbx-g.aOFOXA.AwM1iQpEO8MBOGDBUSSEp1V4gL8', 'Referer': 'https://fhir.epic.com/', 'Sec-Fetch-Dest': 'document', 'Sec-Fetch-Mode': 'navigate', 'Sec-Fetch-Site': 'cross-site', 'Sec-Fetch-User': '?1', 'Upgrade-Insecure-Requests': '1', 'X-Forwarded-For': '69.207.59.155, 10.81.0.121', 'X-Forwarded-Proto': 'https', 'X-Replit-User-Bio': '', 'X-Replit-User-Id': '', 'X-Replit-User-Name': '', 'X-Replit-User-Profile-Image': '', 'X-Replit-User-Roles': '', 'X-Replit-User-Teams': '', 'X-Replit-User-Url': ''}
INFO:routes.oauth_routes:Query parameters received:
INFO:routes.oauth_routes:  - code: <present>
INFO:routes.oauth_routes:  - state: <present>
INFO:routes.oauth_routes:  - error: None
INFO:routes.oauth_routes:  - error_description: None
INFO:routes.oauth_routes:  - all query args: {'code': 'eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOiJ1cm46b2lkOjEuMi44NDAuMTE0MzUwLjEuMTMuMC4xLjcuMy42ODg4ODQuMTAwIiwiY2xpZW50X2lkIjoiZTU3Mzc3ZTItZGZkNS00Njc1LTk2NTktNThjMzNhYTY3YjNmIiwiZXBpYy5lY2kiOiJ1cm46ZXBpYzpPcGVuLkVwaWMtY3VycmVudCIsImVwaWMubWV0YWRhdGEiOiIyeHI3NVpmSG1DWG55YnJobWJWMWszd1JjUE43Z3RjX0kxQjVRUEtXLVVYZ1IxWE9YSzBtX3BLbDMzLTdlbXI2NDNCRFppcEZNbF9hdTQ0dW1VUno1elgybV9yM01XSzR0VWgweVh6RVRoM2NybllkaFZoUkZIcjFqSXVrZ19SUiIsImVwaWMudG9rZW50eXBlIjoiY29kZSIsImV4cCI6MTc1OTU5NjQzNywiaWF0IjoxNzU5NTk2MTM3LCJpc3MiOiJ1cm46b2lkOjEuMi44NDAuMTE0MzUwLjEuMTMuMC4xLjcuMy42ODg4ODQuMTAwIiwianRpIjoiYmIwM2U4NWYtZTZlYy00NDAwLTllZWQtOTg4OGU2ODA5NDVjIiwibmJmIjoxNzU5NTk2MTM3LCJzdWIiOiJlNmF3Ni1SSnVLTzJtYnFqbGVLdmdWUTMifQ.ruLbnFLFz4PlqKWD-Qws4KinUgZQS-ZZOYTriIICYR2eWoHES-79UegZQg2oBqNDBtVsM3A3PAJ91meDZ-Tm8tO6eDDjK8xPMk0HdOIMmhw-ovEsWwP6lUfBPA_Q3stsaJjd0Et91L_B-arrGjVWNngajSFFam5NqV2Pqkl6QqMPadJ4oXDfWmIvxH98Y-PSi-Ij-WOFt4GYpMxUjiZF0s42WIruq_nBPM4Z2YtoV-PYltnT2hgYWt1efhEC6dlJrvqd6muQ4MIWbBLTPuq5ieMVE7vQEuRxVG30B_46CYr-b0y5IXaQovKvkcXmP_y1o9yyBtP_Yo5-f4t7xmWL4Q', 'state': '8mKLUty_pu65YgSf08Nus4ipVHV3DIdXYaO8Um1hUK0'}
INFO:routes.oauth_routes:Session state: 8mKLUty_pu65YgSf08Nus4ipVHV3DIdXYaO8Um1hUK0
INFO:routes.oauth_routes:Session user: True
INFO:routes.oauth_routes:================================
INFO:routes.oauth_routes:=== EPIC OAUTH CALLBACK USER DEBUG ===
INFO:routes.oauth_routes:Callback current user ID: 1
INFO:routes.oauth_routes:Callback current user username: admin
INFO:routes.oauth_routes:Callback current user org_id: 1
INFO:routes.oauth_routes:Callback current user organization object: <Organization Default Organization>
INFO:routes.oauth_routes:Callback Organization ID: 1
INFO:routes.oauth_routes:Callback Organization name: Default Organization
INFO:routes.oauth_routes:Callback Organization epic_client_id: e57377e2-dfd5-4675-9659-58c33aa67b3f
INFO:routes.oauth_routes:=======================================
INFO:routes.oauth_routes:Token exchange - redirect URI: https://55ab1b06-006d-47ec-9b73-b827f4e0f641-00-1fje9legmrd1y.riker.replit.dev/oauth/epic-callback
INFO:routes.oauth_routes:Token exchange - client ID: e57377e2-dfd5-4675-9659-58c33aa67b3f
INFO:routes.oauth_routes:Token exchange - token URL: https://fhir.epic.com/interconnect-fhir-oauth/oauth2/token
INFO:emr.fhir_client:Token exchange request:
INFO:emr.fhir_client:  - URL: https://fhir.epic.com/interconnect-fhir-oauth/oauth2/token
INFO:emr.fhir_client:  - client_id: e57377e2-dfd5-4675-9659-58c33aa67b3f
INFO:emr.fhir_client:  - redirect_uri: https://55ab1b06-006d-47ec-9b73-b827f4e0f641-00-1fje9legmrd1y.riker.replit.dev/oauth/epic-callback
INFO:emr.fhir_client:  - grant_type: authorization_code
INFO:emr.fhir_client:  - code: <present>
INFO:emr.fhir_client:Token exchange response:
INFO:emr.fhir_client:  - status_code: 200
INFO:emr.fhir_client:  - headers: {'Cache-Control': 'no-cache, no-store,no-store', 'Pragma': 'no-cache', 'Content-Type': 'application/json; charset=utf-8', 'Expires': '-1', 'Set-Cookie': 'ASP.NET_SessionId=5aqxigp32104srvkuftict2a; path=/Interconnect-fhir-oauth; secure; HttpOnly; SameSite=Lax, EpicPersistenceCookie=!CSv+bgU9hPuHEm9c5iqg712Vrh0WW5LTpDsIwyo/9DDxOBgHxFRl/ajS2b4EpYzZFS17L6zO/VTnh70=; path=/; Httponly; Secure', 'ServerMetrics': '{"BlockReads":56,"BlockWrites":20,"BlocksAllocated":0,"DBTime":44,"DatabaseCPUTime":34,"ECFNetworkTime":1,"ECFRequestCount":1,"ECFRequestTime":45,"GREF":2346,"JournalEntries":1,"LockWait":0.054,"LocksFailed":0,"LocksGranted":0,"MCommands":44620,"MemoryDifference":0,"NetworkCacheMisses":0,"NetworkUpdates":0,"WorkflowEventBlockReads":56,"WorkflowEventDBTime":44,"WorkflowEventECFNetworkTime":0,"WorkflowEventECFRequestCount":1,"WorkflowEventGREF":2346}', 'Strict-Transport-Security': 'max-age=31536000; includeSubDomains', 'X-Frame-Options': 'sameorigin', 'Access-Control-Allow-Headers': 'origin, authorization, accept, content-type, x-requested-with, prefer, Epic-User-ID, Epic-User-IDType, Epic-Client-ID, soapaction, Epic-MyChartUser-ID, Epic-MyChartUser-IDType', 'Access-Control-Allow-Methods': 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS', 'Access-Control-Allow-Origin': '*', 'Access-Control-Allow-Credentials': 'true', 'Date': 'Sat, 04 Oct 2025 16:42:17 GMT', 'Content-Length': '3408'}
INFO:emr.fhir_client:Successfully exchanged authorization code for Epic access token
INFO:routes.oauth_routes:Epic OAuth flow completed successfully for organization 1
INFO:werkzeug:10.81.0.121 - - [04/Oct/2025 16:42:18] "GET /oauth/epic-callback?code=eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOiJ1cm46b2lkOjEuMi44NDAuMTE0MzUwLjEuMTMuMC4xLjcuMy42ODg4ODQuMTAwIiwiY2xpZW50X2lkIjoiZTU3Mzc3ZTItZGZkNS00Njc1LTk2NTktNThjMzNhYTY3YjNmIiwiZXBpYy5lY2kiOiJ1cm46ZXBpYzpPcGVuLkVwaWMtY3VycmVudCIsImVwaWMubWV0YWRhdGEiOiIyeHI3NVpmSG1DWG55YnJobWJWMWszd1JjUE43Z3RjX0kxQjVRUEtXLVVYZ1IxWE9YSzBtX3BLbDMzLTdlbXI2NDNCRFppcEZNbF9hdTQ0dW1VUno1elgybV9yM01XSzR0VWgweVh6RVRoM2NybllkaFZoUkZIcjFqSXVrZ19SUiIsImVwaWMudG9rZW50eXBlIjoiY29kZSIsImV4cCI6MTc1OTU5NjQzNywiaWF0IjoxNzU5NTk2MTM3LCJpc3MiOiJ1cm46b2lkOjEuMi44NDAuMTE0MzUwLjEuMTMuMC4xLjcuMy42ODg4ODQuMTAwIiwianRpIjoiYmIwM2U4NWYtZTZlYy00NDAwLTllZWQtOTg4OGU2ODA5NDVjIiwibmJmIjoxNzU5NTk2MTM3LCJzdWIiOiJlNmF3Ni1SSnVLTzJtYnFqbGVLdmdWUTMifQ.ruLbnFLFz4PlqKWD-Qws4KinUgZQS-ZZOYTriIICYR2eWoHES-79UegZQg2oBqNDBtVsM3A3PAJ91meDZ-Tm8tO6eDDjK8xPMk0HdOIMmhw-ovEsWwP6lUfBPA_Q3stsaJjd0Et91L_B-arrGjVWNngajSFFam5NqV2Pqkl6QqMPadJ4oXDfWmIvxH98Y-PSi-Ij-WOFt4GYpMxUjiZF0s42WIruq_nBPM4Z2YtoV-PYltnT2hgYWt1efhEC6dlJrvqd6muQ4MIWbBLTPuq5ieMVE7vQEuRxVG30B_46CYr-b0y5IXaQovKvkcXmP_y1o9yyBtP_Yo5-f4t7xmWL4Q&state=8mKLUty_pu65YgSf08Nus4ipVHV3DIdXYaO8Um1hUK0 HTTP/1.1" 302 -
INFO:werkzeug:10.81.0.121 - - [04/Oct/2025 16:42:18] "GET /admin/epic/registration HTTP/1.1" 200 -
INFO:werkzeug:10.81.0.121 - - [04/Oct/2025 16:42:18] "GET /static/css/custom.css HTTP/1.1" 304 -
INFO:werkzeug:10.81.10.248 - - [04/Oct/2025 16:42:18] "GET /static/css/loading-states.css HTTP/1.1" 304 -
INFO:werkzeug:10.81.10.248 - - [04/Oct/2025 16:42:20] "GET /oauth/epic-status HTTP/1.1" 200 -
INFO:werkzeug:10.81.10.248 - - [04/Oct/2025 16:42:21] "GET /oauth/epic-status HTTP/1.1" 200 -
INFO:werkzeug:10.81.0.121 - - [04/Oct/2025 16:42:22] "GET /admin/epic/registration HTTP/1.1" 200 -
INFO:werkzeug:10.81.0.121 - - [04/Oct/2025 16:42:22] "GET /static/css/custom.css HTTP/1.1" 304 -
INFO:werkzeug:10.81.0.121 - - [04/Oct/2025 16:42:22] "GET /static/css/loading-states.css HTTP/1.1" 304 -
INFO:werkzeug:10.81.10.248 - - [04/Oct/2025 16:42:22] "GET /oauth/epic-status HTTP/1.1" 200 -
INFO:werkzeug:10.81.0.121 - - [04/Oct/2025 16:42:30] "GET /auth/logout HTTP/1.1" 302 -
INFO:werkzeug:10.81.0.121 - - [04/Oct/2025 16:42:30] "GET /auth/login HTTP/1.1" 200 -
INFO:werkzeug:10.81.0.121 - - [04/Oct/2025 16:42:30] "GET /static/css/custom.css HTTP/1.1" 304 -
INFO:werkzeug:10.81.5.79 - - [04/Oct/2025 16:42:30] "GET /static/css/medical_terminology_ui.css HTTP/1.1" 304 -
INFO:werkzeug:10.81.0.121 - - [04/Oct/2025 16:42:30] "GET /static/css/loading-states.css HTTP/1.1" 304 -
INFO:werkzeug:10.81.0.121 - - [04/Oct/2025 16:42:30] "GET /static/css/medical_styles.css HTTP/1.1" 304 -
INFO:werkzeug:10.81.5.79 - - [04/Oct/2025 16:42:30] "GET /static/js/medical_terminology.js HTTP/1.1" 304 -
INFO:werkzeug:10.81.5.79 - - [04/Oct/2025 16:42:36] "POST /auth/login HTTP/1.1" 302 -
INFO:werkzeug:10.81.5.79 - - [04/Oct/2025 16:42:37] "GET / HTTP/1.1" 200 -
INFO:werkzeug:10.81.0.121 - - [04/Oct/2025 16:42:37] "GET /static/css/custom.css HTTP/1.1" 304 -
INFO:werkzeug:10.81.0.121 - - [04/Oct/2025 16:42:37] "GET /static/css/medical_styles.css HTTP/1.1" 304 -
INFO:werkzeug:10.81.0.121 - - [04/Oct/2025 16:42:37] "GET /static/css/medical_terminology_ui.css HTTP/1.1" 304 -
INFO:werkzeug:10.81.6.68 - - [04/Oct/2025 16:42:37] "GET /static/css/loading-states.css HTTP/1.1" 304 -
INFO:werkzeug:10.81.5.79 - - [04/Oct/2025 16:42:37] "GET /static/js/medical_terminology.js HTTP/1.1" 304 -
INFO:werkzeug:10.81.5.79 - - [04/Oct/2025 16:42:40] "GET /patients HTTP/1.1" 302 -
INFO:werkzeug:10.81.5.79 - - [04/Oct/2025 16:42:41] "GET /screening/list HTTP/1.1" 200 -
INFO:werkzeug:10.81.6.68 - - [04/Oct/2025 16:42:41] "GET /static/css/custom.css HTTP/1.1" 304 -
INFO:werkzeug:10.81.0.121 - - [04/Oct/2025 16:42:41] "GET /static/css/medical_terminology_ui.css HTTP/1.1" 304 -
INFO:werkzeug:10.81.0.121 - - [04/Oct/2025 16:42:41] "GET /static/css/medical_styles.css HTTP/1.1" 304 -
INFO:werkzeug:10.81.0.121 - - [04/Oct/2025 16:42:41] "GET /static/css/loading-states.css HTTP/1.1" 304 -
INFO:werkzeug:10.81.5.79 - - [04/Oct/2025 16:42:42] "GET /static/js/screening_modals.js HTTP/1.1" 304 -
INFO:werkzeug:10.81.0.121 - - [04/Oct/2025 16:42:42] "GET /static/js/screening_performance.js HTTP/1.1" 304 -
INFO:werkzeug:10.81.0.121 - - [04/Oct/2025 16:42:42] "GET /static/js/medical_terminology.js HTTP/1.1" 304 -
INFO:werkzeug:10.81.0.121 - - [04/Oct/2025 16:42:46] "GET /dashboard HTTP/1.1" 200 -
INFO:werkzeug:10.81.5.79 - - [04/Oct/2025 16:42:46] "GET /static/css/medical_styles.css HTTP/1.1" 304 -
INFO:werkzeug:10.81.0.121 - - [04/Oct/2025 16:42:46] "GET /static/css/custom.css HTTP/1.1" 304 -
INFO:werkzeug:10.81.0.121 - - [04/Oct/2025 16:42:46] "GET /static/css/medical_terminology_ui.css HTTP/1.1" 304 -
INFO:werkzeug:10.81.6.68 - - [04/Oct/2025 16:42:46] "GET /static/css/loading-states.css HTTP/1.1" 304 -
INFO:werkzeug:10.81.0.121 - - [04/Oct/2025 16:42:46] "GET /static/js/medical_terminology.js HTTP/1.1" 304 -
INFO:services.comprehensive_emr_sync:ComprehensiveEMRSync: forcing database/background token usage for org 1
INFO:services.epic_fhir_service:Creating background Epic FHIR client for organization 1
INFO:emr.fhir_client:Epic FHIR tokens set successfully
INFO:routes.oauth_routes:Background Epic FHIR client created for organization 1
INFO:services.comprehensive_emr_sync:ComprehensiveEMRSync: using database-stored tokens for stable sync operations
INFO:services.comprehensive_emr_sync:Initialized ComprehensiveEMRSync for organization 1
INFO:services.comprehensive_emr_sync:Starting patient discovery from Epic FHIR
INFO:services.epic_fhir_service:Authentication verified for org 1
INFO:services.comprehensive_emr_sync:Retrieving patient erXuFYUfucBZaryVksYEcMg3 from Epic
INFO:services.comprehensive_emr_sync:Successfully retrieved patient erXuFYUfucBZaryVksYEcMg3
INFO:services.comprehensive_emr_sync:Retrieving patient eq081-VQEgP8drUUqCWzHfw3 from Epic
INFO:services.comprehensive_emr_sync:Successfully retrieved patient eq081-VQEgP8drUUqCWzHfw3
INFO:services.comprehensive_emr_sync:Retrieving patient eAB3mDIBBcyUKviyzrxsnAw3 from Epic
INFO:services.comprehensive_emr_sync:Successfully retrieved patient eAB3mDIBBcyUKviyzrxsnAw3
INFO:services.comprehensive_emr_sync:Retrieving patient egqBHVfQlt4Bw3XGXoxVxHg3 from Epic
INFO:services.comprehensive_emr_sync:Successfully retrieved patient egqBHVfQlt4Bw3XGXoxVxHg3
INFO:services.comprehensive_emr_sync:Retrieving patient eIXesllypH3M9tAA5WdJftQ3 from Epic
INFO:services.comprehensive_emr_sync:Successfully retrieved patient eIXesllypH3M9tAA5WdJftQ3
INFO:services.comprehensive_emr_sync:Retrieving patient eh2xYHuzl9nkSFVvV3osUHg3 from Epic
INFO:services.comprehensive_emr_sync:Successfully retrieved patient eh2xYHuzl9nkSFVvV3osUHg3
INFO:services.comprehensive_emr_sync:Retrieving patient e0w0LEDCYtfckT6N.CkJKCw3 from Epic
INFO:services.comprehensive_emr_sync:Successfully retrieved patient e0w0LEDCYtfckT6N.CkJKCw3
INFO:services.comprehensive_emr_sync:Retrieved 7 Epic sandbox patients
INFO:services.comprehensive_emr_sync:Discovered 7 patients from Epic
INFO:services.comprehensive_emr_sync:Updated existing patient: Camila Maria Lopez
INFO:services.comprehensive_emr_sync:Updated existing patient: Derrick Lin
INFO:services.comprehensive_emr_sync:Updated existing patient: Desiree Caroline Powell
INFO:services.comprehensive_emr_sync:Updated existing patient: Elijah John Davis
INFO:services.comprehensive_emr_sync:Updated existing patient: Linda Jane Ross
INFO:services.comprehensive_emr_sync:Updated existing patient: Olivia Anne Roberts
INFO:services.comprehensive_emr_sync:Updated existing patient: Warren James McGinnis
INFO:services.comprehensive_emr_sync:Appointment-Based Screening Prioritization is ENABLED
INFO:services.appointment_prioritization:Initialized AppointmentBasedPrioritization for organization 1
INFO:services.appointment_prioritization:Getting priority patients with appointments between 2025-10-04 and 2025-10-18
INFO:services.appointment_prioritization:Found 0 priority patients with 0 appointments
INFO:services.comprehensive_emr_sync:No patients eligible for Appointment-Based Screening Prioritization, continuing general EMR sync
INFO:services.comprehensive_emr_sync:Starting comprehensive sync for patient erXuFYUfucBZaryVksYEcMg3
INFO:services.epic_fhir_service:Authentication verified for org 1
INFO:services.comprehensive_emr_sync:Syncing patient demographics for erXuFYUfucBZaryVksYEcMg3
INFO:services.epic_fhir_service:Authentication verified for org 1
INFO:services.epic_fhir_service:Successfully synced patient erXuFYUfucBZaryVksYEcMg3 from Epic
INFO:services.comprehensive_emr_sync:Successfully synced patient demographics: Camila Maria Lopez
INFO:services.comprehensive_emr_sync:Document count changed for erXuFYUfucBZaryVksYEcMg3: 0 -> 16, cannot skip
INFO:services.comprehensive_emr_sync:Syncing conditions for patient erXuFYUfucBZaryVksYEcMg3
INFO:services.comprehensive_emr_sync:Syncing observations for patient erXuFYUfucBZaryVksYEcMg3
INFO:services.comprehensive_emr_sync:Processed 0 screening-relevant observations
INFO:services.comprehensive_emr_sync:Syncing documents for patient erXuFYUfucBZaryVksYEcMg3
INFO:services.comprehensive_emr_sync:Epic returned 16 documents for patient erXuFYUfucBZaryVksYEcMg3
INFO:services.comprehensive_emr_sync:Document has no date from Epic FHIR, using current date as fallback for sandbox testing
INFO:services.comprehensive_emr_sync:Epic document IDs: eyO8IDtD0tt9TaifYClqhBg3, encdjwOWwqeHpW0NpwHJNHA3, eGZN8PA9QEAp.PdHsUOaCtQ3, eSwdk16bqhvFIbg6xfERksA3, et.yIC.ZwvTPLBR-8jvwlKw3...
INFO:services.comprehensive_emr_sync:Document sync summary - Total: 16, New: 0, Skipped: 15
INFO:services.comprehensive_emr_sync:Syncing encounters for patient erXuFYUfucBZaryVksYEcMg3
INFO:services.comprehensive_emr_sync:Patient erXuFYUfucBZaryVksYEcMg3 visit: Orders Only on 2023-06-02 00:00:00
INFO:services.comprehensive_emr_sync:Patient erXuFYUfucBZaryVksYEcMg3 visit: Office Visit on 2023-05-21 00:00:00
INFO:services.comprehensive_emr_sync:Processed 2 encounters
INFO:services.comprehensive_emr_sync:Syncing appointments for patient erXuFYUfucBZaryVksYEcMg3
INFO:services.comprehensive_emr_sync:Updated appointment: eGFFFp0KKaZdjgF36sTfrjXaLjBH89aU3nWCXNCrJ4x03
INFO:services.comprehensive_emr_sync:Updated appointment: eGFFFp0KKaZdjgF36sTfrjUY.ncsYpxzuKSpa51uP6OA3
INFO:services.comprehensive_emr_sync:Updated appointment: eGFFFp0KKaZdjgF36sTfrjYhfIWKytcVWCHb2RL1710I3
INFO:services.comprehensive_emr_sync:Updated appointment: eZwitZgFWP-uwOnD.EFyOYN3ee0oO99tej7KEPE.bRko3
INFO:services.comprehensive_emr_sync:Updated appointment: eZwitZgFWP-uwOnD.EFyOYL9Wasd5MlRGj84G1jhHAEY3
INFO:services.comprehensive_emr_sync:Updated appointment: eZwitZgFWP-uwOnD.EFyOYN.5FdkfqRMU.sNLdseey9M3
INFO:services.comprehensive_emr_sync:Processed 0 appointments
INFO:services.comprehensive_emr_sync:Processing screening eligibility for patient erXuFYUfucBZaryVksYEcMg3
INFO:services.comprehensive_emr_sync:Updated screening status for erXuFYUfucBZaryVksYEcMg3: Immunization Review - due (0 manual + 0 FHIR docs matched)
INFO:services.comprehensive_emr_sync:Updated 1 screening statuses
INFO:services.comprehensive_emr_sync:Successfully completed comprehensive sync for patient erXuFYUfucBZaryVksYEcMg3
INFO:services.comprehensive_emr_sync:Starting comprehensive sync for patient eq081-VQEgP8drUUqCWzHfw3
INFO:services.epic_fhir_service:Authentication verified for org 1
INFO:services.comprehensive_emr_sync:Syncing patient demographics for eq081-VQEgP8drUUqCWzHfw3
INFO:services.epic_fhir_service:Authentication verified for org 1
INFO:services.epic_fhir_service:Successfully synced patient eq081-VQEgP8drUUqCWzHfw3 from Epic
INFO:services.comprehensive_emr_sync:Successfully synced patient demographics: Derrick Lin
INFO:services.comprehensive_emr_sync:Document count changed for eq081-VQEgP8drUUqCWzHfw3: 0 -> 8, cannot skip
INFO:services.comprehensive_emr_sync:Syncing conditions for patient eq081-VQEgP8drUUqCWzHfw3
INFO:services.comprehensive_emr_sync:Syncing observations for patient eq081-VQEgP8drUUqCWzHfw3
INFO:services.comprehensive_emr_sync:Processed 0 screening-relevant observations
INFO:services.comprehensive_emr_sync:Syncing documents for patient eq081-VQEgP8drUUqCWzHfw3
INFO:services.comprehensive_emr_sync:Epic returned 8 documents for patient eq081-VQEgP8drUUqCWzHfw3
INFO:services.comprehensive_emr_sync:Document has no date from Epic FHIR, using current date as fallback for sandbox testing
INFO:services.comprehensive_emr_sync:Epic document IDs: eH-.Q6gjsoLu5MxGSBpoNjw3, e7Gyw00b90CahDeL37PuLXg3, ejDIN0n.MmjLDyzVIIEGGEA3, ervmF.QO5yZFD-635nz8H4Q3, eNUof569QcEHOH3Q2RjNjeQ3...
INFO:services.comprehensive_emr_sync:Document sync summary - Total: 8, New: 0, Skipped: 7
INFO:services.comprehensive_emr_sync:Syncing encounters for patient eq081-VQEgP8drUUqCWzHfw3
INFO:services.comprehensive_emr_sync:Processed 0 encounters
INFO:services.comprehensive_emr_sync:Syncing appointments for patient eq081-VQEgP8drUUqCWzHfw3
INFO:services.comprehensive_emr_sync:Updated appointment: evTiQA9oPDAS66tOkrTIbXVkgWPaOTrRcucSsvdoeNfI3
INFO:services.comprehensive_emr_sync:Updated appointment: evTiQA9oPDAS66tOkrTIbXdvQysdvJopbk.a8HGzO7k43
INFO:services.comprehensive_emr_sync:Updated appointment: ejxqY5Pdk6FFOvtrireyw8RTvNd-wqa5ZQPOyQb0Y60g3
INFO:services.comprehensive_emr_sync:Updated appointment: ejxqY5Pdk6FFOvtrireyw8aAAsuMyNiTARz1s.VhrtT43
INFO:services.comprehensive_emr_sync:Updated appointment: ejxqY5Pdk6FFOvtrireyw8TQOhRQgm-NKHidELkOetEk3
INFO:services.comprehensive_emr_sync:Processed 0 appointments
INFO:services.comprehensive_emr_sync:Processing screening eligibility for patient eq081-VQEgP8drUUqCWzHfw3
INFO:services.comprehensive_emr_sync:Manual document match: a1c_lab_result_20250915.pdf (ID: 2) for A1C Test
ERROR:services.comprehensive_emr_sync:Error updating screening status: name 'List' is not defined
ERROR:services.comprehensive_emr_sync:Traceback (most recent call last):
  File "/home/runner/workspace/services/comprehensive_emr_sync.py", line 1067, in _update_screening_status
    from utils.date_helpers import calculate_due_date
  File "/home/runner/workspace/utils/date_helpers.py", line 239, in <module>
    def get_quarters_in_range(start_date: date, end_date: date) -> List[Tuple[date, date]]:
                                                                   ^^^^
NameError: name 'List' is not defined

INFO:services.comprehensive_emr_sync:Updated screening status for eq081-VQEgP8drUUqCWzHfw3: Lipid Panel - due (0 manual + 0 FHIR docs matched)
INFO:services.comprehensive_emr_sync:Updated screening status for eq081-VQEgP8drUUqCWzHfw3: Electrocardiogram (ECG) - due (0 manual + 0 FHIR docs matched)
INFO:services.comprehensive_emr_sync:Updated screening status for eq081-VQEgP8drUUqCWzHfw3: Colorectal Cancer Screening - due (0 manual + 0 FHIR docs matched)
INFO:services.comprehensive_emr_sync:Updated screening status for eq081-VQEgP8drUUqCWzHfw3: Immunization Review - due (0 manual + 0 FHIR docs matched)
INFO:services.comprehensive_emr_sync:Updated 5 screening statuses
INFO:services.comprehensive_emr_sync:Successfully completed comprehensive sync for patient eq081-VQEgP8drUUqCWzHfw3
INFO:services.comprehensive_emr_sync:Starting comprehensive sync for patient eAB3mDIBBcyUKviyzrxsnAw3
INFO:services.epic_fhir_service:Authentication verified for org 1
INFO:services.comprehensive_emr_sync:Syncing patient demographics for eAB3mDIBBcyUKviyzrxsnAw3
INFO:services.epic_fhir_service:Authentication verified for org 1
INFO:services.epic_fhir_service:Successfully synced patient eAB3mDIBBcyUKviyzrxsnAw3 from Epic
INFO:services.comprehensive_emr_sync:Successfully synced patient demographics: Desiree Caroline Powell
INFO:services.comprehensive_emr_sync:No changes detected for eAB3mDIBBcyUKviyzrxsnAw3 since last sync, skipping reprocessing
INFO:services.comprehensive_emr_sync:Skipped reprocessing for eAB3mDIBBcyUKviyzrxsnAw3 - no changes detected
INFO:services.comprehensive_emr_sync:Starting comprehensive sync for patient egqBHVfQlt4Bw3XGXoxVxHg3
INFO:services.epic_fhir_service:Authentication verified for org 1
INFO:services.comprehensive_emr_sync:Syncing patient demographics for egqBHVfQlt4Bw3XGXoxVxHg3
INFO:services.epic_fhir_service:Authentication verified for org 1
INFO:services.epic_fhir_service:Successfully synced patient egqBHVfQlt4Bw3XGXoxVxHg3 from Epic
INFO:services.comprehensive_emr_sync:Successfully synced patient demographics: Elijah John Davis
INFO:services.comprehensive_emr_sync:Document count changed for egqBHVfQlt4Bw3XGXoxVxHg3: 0 -> 1, cannot skip
INFO:services.comprehensive_emr_sync:Syncing conditions for patient egqBHVfQlt4Bw3XGXoxVxHg3
INFO:services.comprehensive_emr_sync:Syncing observations for patient egqBHVfQlt4Bw3XGXoxVxHg3
INFO:services.comprehensive_emr_sync:Processed 0 screening-relevant observations
INFO:services.comprehensive_emr_sync:Syncing documents for patient egqBHVfQlt4Bw3XGXoxVxHg3
INFO:services.comprehensive_emr_sync:Epic returned 2 documents for patient egqBHVfQlt4Bw3XGXoxVxHg3
INFO:services.comprehensive_emr_sync:Document has no date from Epic FHIR, using current date as fallback for sandbox testing
INFO:services.comprehensive_emr_sync:Epic document IDs: eO5vFnup6ui6VGy0lAVCuXw3
INFO:services.comprehensive_emr_sync:Document sync summary - Total: 2, New: 0, Skipped: 1
INFO:services.comprehensive_emr_sync:Syncing encounters for patient egqBHVfQlt4Bw3XGXoxVxHg3
INFO:services.comprehensive_emr_sync:Patient egqBHVfQlt4Bw3XGXoxVxHg3 visit: Office Visit on 2019-05-24 00:00:00
INFO:services.comprehensive_emr_sync:Processed 1 encounters
INFO:services.comprehensive_emr_sync:Syncing appointments for patient egqBHVfQlt4Bw3XGXoxVxHg3
INFO:services.comprehensive_emr_sync:Updated appointment: eBIwj8viFzhwmT9dRb-Y8PyY0n6WfglhV3mN3mI0ay303
INFO:services.comprehensive_emr_sync:Updated appointment: eVAPSUh8LrEy.NQsC3WqFJQhvEBtj-kbO4JrHdLAuolk3
INFO:services.comprehensive_emr_sync:Updated appointment: eVAPSUh8LrEy.NQsC3WqFJTPgoP5PezppluyhnjfKp1U3
INFO:services.comprehensive_emr_sync:Processed 0 appointments
INFO:services.comprehensive_emr_sync:Processing screening eligibility for patient egqBHVfQlt4Bw3XGXoxVxHg3
INFO:services.comprehensive_emr_sync:Updated screening status for egqBHVfQlt4Bw3XGXoxVxHg3: Immunization Review - due (0 manual + 0 FHIR docs matched)
INFO:services.comprehensive_emr_sync:Updated 1 screening statuses
INFO:services.comprehensive_emr_sync:Successfully completed comprehensive sync for patient egqBHVfQlt4Bw3XGXoxVxHg3
INFO:services.comprehensive_emr_sync:Starting comprehensive sync for patient eIXesllypH3M9tAA5WdJftQ3
INFO:services.epic_fhir_service:Authentication verified for org 1
INFO:services.comprehensive_emr_sync:Syncing patient demographics for eIXesllypH3M9tAA5WdJftQ3
INFO:services.epic_fhir_service:Authentication verified for org 1
INFO:services.epic_fhir_service:Successfully synced patient eIXesllypH3M9tAA5WdJftQ3 from Epic
INFO:services.comprehensive_emr_sync:Successfully synced patient demographics: Linda Jane Ross
INFO:services.comprehensive_emr_sync:Document count changed for eIXesllypH3M9tAA5WdJftQ3: 0 -> 2, cannot skip
INFO:services.comprehensive_emr_sync:Syncing conditions for patient eIXesllypH3M9tAA5WdJftQ3
INFO:services.comprehensive_emr_sync:Syncing observations for patient eIXesllypH3M9tAA5WdJftQ3
INFO:services.comprehensive_emr_sync:Processed 0 screening-relevant observations
INFO:services.comprehensive_emr_sync:Syncing documents for patient eIXesllypH3M9tAA5WdJftQ3
INFO:services.comprehensive_emr_sync:Epic returned 2 documents for patient eIXesllypH3M9tAA5WdJftQ3
INFO:services.comprehensive_emr_sync:Document has no date from Epic FHIR, using current date as fallback for sandbox testing
INFO:services.comprehensive_emr_sync:Epic document IDs: ef7BMm4gk0LDKIGdTRfJO-Q3
INFO:services.comprehensive_emr_sync:Document sync summary - Total: 2, New: 0, Skipped: 1
INFO:services.comprehensive_emr_sync:Syncing encounters for patient eIXesllypH3M9tAA5WdJftQ3
INFO:services.comprehensive_emr_sync:Patient eIXesllypH3M9tAA5WdJftQ3 visit: Inpatient on 2019-05-24 20:32:25+00:00
INFO:services.comprehensive_emr_sync:Processed 1 encounters
INFO:services.comprehensive_emr_sync:Syncing appointments for patient eIXesllypH3M9tAA5WdJftQ3
INFO:services.comprehensive_emr_sync:Processed 0 appointments
INFO:services.comprehensive_emr_sync:Processing screening eligibility for patient eIXesllypH3M9tAA5WdJftQ3
INFO:services.comprehensive_emr_sync:Updated screening status for eIXesllypH3M9tAA5WdJftQ3: A1C Test - due (0 manual + 0 FHIR docs matched)
INFO:services.comprehensive_emr_sync:Updated screening status for eIXesllypH3M9tAA5WdJftQ3: Lipid Panel - due (0 manual + 0 FHIR docs matched)
INFO:services.comprehensive_emr_sync:Updated screening status for eIXesllypH3M9tAA5WdJftQ3: Electrocardiogram (ECG) - due (0 manual + 0 FHIR docs matched)
INFO:services.comprehensive_emr_sync:Updated screening status for eIXesllypH3M9tAA5WdJftQ3: Cervical Cancer Screening - due (0 manual + 0 FHIR docs matched)
INFO:services.comprehensive_emr_sync:Manual document match: colonoscopy_report_20250915.pdf (ID: 3) for Colorectal Cancer Screening
ERROR:services.comprehensive_emr_sync:Error updating screening status: name 'List' is not defined
ERROR:services.comprehensive_emr_sync:Traceback (most recent call last):
  File "/home/runner/workspace/services/comprehensive_emr_sync.py", line 1067, in _update_screening_status
    from utils.date_helpers import calculate_due_date
  File "/home/runner/workspace/utils/date_helpers.py", line 239, in <module>
    def get_quarters_in_range(start_date: date, end_date: date) -> List[Tuple[date, date]]:
                                                                   ^^^^
NameError: name 'List' is not defined

INFO:services.comprehensive_emr_sync:Updated screening status for eIXesllypH3M9tAA5WdJftQ3: Mammogram - due (0 manual + 0 FHIR docs matched)
INFO:services.comprehensive_emr_sync:Updated screening status for eIXesllypH3M9tAA5WdJftQ3: Immunization Review - due (0 manual + 0 FHIR docs matched)
INFO:services.comprehensive_emr_sync:Updated 7 screening statuses
INFO:services.comprehensive_emr_sync:Successfully completed comprehensive sync for patient eIXesllypH3M9tAA5WdJftQ3
INFO:services.comprehensive_emr_sync:Starting comprehensive sync for patient eh2xYHuzl9nkSFVvV3osUHg3
INFO:services.epic_fhir_service:Authentication verified for org 1
INFO:services.comprehensive_emr_sync:Syncing patient demographics for eh2xYHuzl9nkSFVvV3osUHg3
INFO:services.epic_fhir_service:Authentication verified for org 1
INFO:services.epic_fhir_service:Successfully synced patient eh2xYHuzl9nkSFVvV3osUHg3 from Epic
INFO:services.comprehensive_emr_sync:Successfully synced patient demographics: Olivia Anne Roberts
INFO:services.comprehensive_emr_sync:Document count changed for eh2xYHuzl9nkSFVvV3osUHg3: 0 -> 1, cannot skip
INFO:services.comprehensive_emr_sync:Syncing conditions for patient eh2xYHuzl9nkSFVvV3osUHg3
INFO:services.comprehensive_emr_sync:Syncing observations for patient eh2xYHuzl9nkSFVvV3osUHg3
INFO:services.comprehensive_emr_sync:Processed 0 screening-relevant observations
INFO:services.comprehensive_emr_sync:Syncing documents for patient eh2xYHuzl9nkSFVvV3osUHg3
INFO:services.comprehensive_emr_sync:Epic returned 2 documents for patient eh2xYHuzl9nkSFVvV3osUHg3
INFO:services.comprehensive_emr_sync:Document has no date from Epic FHIR, using current date as fallback for sandbox testing
INFO:services.comprehensive_emr_sync:Epic document IDs: eRlfm6nG.k9mcCZaAA8PJ2w3
INFO:services.comprehensive_emr_sync:Document sync summary - Total: 2, New: 0, Skipped: 1
INFO:services.comprehensive_emr_sync:Syncing encounters for patient eh2xYHuzl9nkSFVvV3osUHg3
INFO:services.comprehensive_emr_sync:Processed 0 encounters
INFO:services.comprehensive_emr_sync:Syncing appointments for patient eh2xYHuzl9nkSFVvV3osUHg3
INFO:services.comprehensive_emr_sync:Processed 0 appointments
INFO:services.comprehensive_emr_sync:Processing screening eligibility for patient eh2xYHuzl9nkSFVvV3osUHg3
INFO:services.comprehensive_emr_sync:Updated screening status for eh2xYHuzl9nkSFVvV3osUHg3: Cervical Cancer Screening - due (0 manual + 0 FHIR docs matched)
INFO:services.comprehensive_emr_sync:Updated screening status for eh2xYHuzl9nkSFVvV3osUHg3: Immunization Review - due (0 manual + 0 FHIR docs matched)
INFO:services.comprehensive_emr_sync:Updated 2 screening statuses
INFO:services.comprehensive_emr_sync:Successfully completed comprehensive sync for patient eh2xYHuzl9nkSFVvV3osUHg3
INFO:services.comprehensive_emr_sync:Starting comprehensive sync for patient e0w0LEDCYtfckT6N.CkJKCw3
INFO:services.epic_fhir_service:Authentication verified for org 1
INFO:services.comprehensive_emr_sync:Syncing patient demographics for e0w0LEDCYtfckT6N.CkJKCw3
INFO:services.epic_fhir_service:Authentication verified for org 1
INFO:services.epic_fhir_service:Successfully synced patient e0w0LEDCYtfckT6N.CkJKCw3 from Epic
INFO:services.comprehensive_emr_sync:Successfully synced patient demographics: Warren James McGinnis
INFO:services.comprehensive_emr_sync:Document count changed for e0w0LEDCYtfckT6N.CkJKCw3: 0 -> 5, cannot skip
INFO:services.comprehensive_emr_sync:Syncing conditions for patient e0w0LEDCYtfckT6N.CkJKCw3
INFO:services.comprehensive_emr_sync:Syncing observations for patient e0w0LEDCYtfckT6N.CkJKCw3
INFO:services.comprehensive_emr_sync:Screening observation for e0w0LEDCYtfckT6N.CkJKCw3: 2093-3 = 187 mg/dL on 2019-05-28 15:59:00+00:00
INFO:services.comprehensive_emr_sync:Processed 1 screening-relevant observations
INFO:services.comprehensive_emr_sync:Syncing documents for patient e0w0LEDCYtfckT6N.CkJKCw3
INFO:services.comprehensive_emr_sync:Epic returned 5 documents for patient e0w0LEDCYtfckT6N.CkJKCw3
INFO:services.comprehensive_emr_sync:Document has no date from Epic FHIR, using current date as fallback for sandbox testing
INFO:services.comprehensive_emr_sync:Epic document IDs: ewbHjBDB7KFwiZ1B.73wAkA3, e2LI3pMSHJ-BZ7qKifTmlhw3, ejQPRy7XA9sgOPZmWi2aR3g3, eEBiTuPQOVIQJmvSh-UuuPA3
INFO:services.comprehensive_emr_sync:Document sync summary - Total: 5, New: 0, Skipped: 4
INFO:services.comprehensive_emr_sync:Syncing encounters for patient e0w0LEDCYtfckT6N.CkJKCw3
INFO:services.comprehensive_emr_sync:Processed 0 encounters
INFO:services.comprehensive_emr_sync:Syncing appointments for patient e0w0LEDCYtfckT6N.CkJKCw3
INFO:services.comprehensive_emr_sync:Updated appointment: eFIFqrdNNcaZqN8UsTYlUkM9JguzV4seQ-hO-443VxLA3
INFO:services.comprehensive_emr_sync:Processed 0 appointments
INFO:services.comprehensive_emr_sync:Processing screening eligibility for patient e0w0LEDCYtfckT6N.CkJKCw3
INFO:services.comprehensive_emr_sync:Updated screening status for e0w0LEDCYtfckT6N.CkJKCw3: A1C Test - due (0 manual + 0 FHIR docs matched)
INFO:services.comprehensive_emr_sync:Updated screening status for e0w0LEDCYtfckT6N.CkJKCw3: Lipid Panel - due (0 manual + 0 FHIR docs matched)
INFO:services.comprehensive_emr_sync:Manual document match: ecg_report_20250915.pdf (ID: 4) for Electrocardiogram (ECG)
ERROR:services.comprehensive_emr_sync:Error updating screening status: name 'List' is not defined
ERROR:services.comprehensive_emr_sync:Traceback (most recent call last):
  File "/home/runner/workspace/services/comprehensive_emr_sync.py", line 1067, in _update_screening_status
    from utils.date_helpers import calculate_due_date
  File "/home/runner/workspace/utils/date_helpers.py", line 239, in <module>
    def get_quarters_in_range(start_date: date, end_date: date) -> List[Tuple[date, date]]:
                                                                   ^^^^
NameError: name 'List' is not defined

INFO:services.comprehensive_emr_sync:Updated screening status for e0w0LEDCYtfckT6N.CkJKCw3: Colorectal Cancer Screening - due (0 manual + 0 FHIR docs matched)
INFO:services.comprehensive_emr_sync:Updated screening status for e0w0LEDCYtfckT6N.CkJKCw3: Immunization Review - due (0 manual + 0 FHIR docs matched)
INFO:services.comprehensive_emr_sync:Updated 5 screening statuses
INFO:services.comprehensive_emr_sync:Successfully completed comprehensive sync for patient e0w0LEDCYtfckT6N.CkJKCw3
INFO:services.comprehensive_emr_sync:Discovery and sync completed: 7 patients synced, 21 screenings updated