TML, like Gecko) Replit/1.0.14 Chrome/124.0.6367.119 Electron/30.0.3 Safari/537.36"
ERROR:routes.admin_routes:Error in admin documents: (psycopg2.errors.UndefinedColumn) column fhir_documents.is_healthprep_generated does not exist
LINE 1: ...elevance_score AS fhir_documents_relevance_score, fhir_docum...
                                                             ^

[SQL: SELECT fhir_documents.id AS fhir_documents_id, fhir_documents.patient_id AS fhir_documents_patient_id, fhir_documents.org_id AS fhir_documents_org_id, fhir_documents.epic_document_id AS fhir_documents_epic_document_id, fhir_documents.fhir_document_reference AS fhir_documents_fhir_document_reference, fhir_documents.document_type_code AS fhir_documents_document_type_code, fhir_documents.document_type_display AS fhir_documents_document_type_display, fhir_documents.title AS fhir_documents_title, fhir_documents.description AS fhir_documents_description, fhir_documents.creation_date AS fhir_documents_creation_date, fhir_documents.document_date AS fhir_documents_document_date, fhir_documents.author_name AS fhir_documents_author_name, fhir_documents.content_url AS fhir_documents_content_url, fhir_documents.content_type AS fhir_documents_content_type, fhir_documents.content_size AS fhir_documents_content_size, fhir_documents.content_hash AS fhir_documents_content_hash, fhir_documents.is_processed AS fhir_documents_is_processed, fhir_documents.processing_status AS fhir_documents_processing_status, fhir_documents.processing_error AS fhir_documents_processing_error, fhir_documents.ocr_text AS fhir_documents_ocr_text, fhir_documents.relevance_score AS fhir_documents_relevance_score, fhir_documents.is_healthprep_generated AS fhir_documents_is_healthprep_generated, fhir_documents.last_accessed AS fhir_documents_last_accessed, fhir_documents.created_at AS fhir_documents_created_at, fhir_documents.updated_at AS fhir_documents_updated_at 
FROM fhir_documents 
WHERE fhir_documents.patient_id = %(patient_id_1)s]
[parameters: {'patient_id_1': 10}]
(Background on this error at: https://sqlalche.me/e/20/f405)
ERROR:app:Exception on /admin/documents [GET]
Traceback (most recent call last):
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column fhir_documents.is_healthprep_generated does not exist
LINE 1: ...elevance_score AS fhir_documents_relevance_score, fhir_docum...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/runner/workspace/routes/admin_routes.py", line 2125, in admin_documents
    fhir_documents = FHIRDocument.query.filter_by(patient_id=patient.id).all()
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2704, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2857, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
           ^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1840, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1980, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column fhir_documents.is_healthprep_generated does not exist
LINE 1: ...elevance_score AS fhir_documents_relevance_score, fhir_docum...
                                                             ^

[SQL: SELECT fhir_documents.id AS fhir_documents_id, fhir_documents.patient_id AS fhir_documents_patient_id, fhir_documents.org_id AS fhir_documents_org_id, fhir_documents.epic_document_id AS fhir_documents_epic_document_id, fhir_documents.fhir_document_reference AS fhir_documents_fhir_document_reference, fhir_documents.document_type_code AS fhir_documents_document_type_code, fhir_documents.document_type_display AS fhir_documents_document_type_display, fhir_documents.title AS fhir_documents_title, fhir_documents.description AS fhir_documents_description, fhir_documents.creation_date AS fhir_documents_creation_date, fhir_documents.document_date AS fhir_documents_document_date, fhir_documents.author_name AS fhir_documents_author_name, fhir_documents.content_url AS fhir_documents_content_url, fhir_documents.content_type AS fhir_documents_content_type, fhir_documents.content_size AS fhir_documents_content_size, fhir_documents.content_hash AS fhir_documents_content_hash, fhir_documents.is_processed AS fhir_documents_is_processed, fhir_documents.processing_status AS fhir_documents_processing_status, fhir_documents.processing_error AS fhir_documents_processing_error, fhir_documents.ocr_text AS fhir_documents_ocr_text, fhir_documents.relevance_score AS fhir_documents_relevance_score, fhir_documents.is_healthprep_generated AS fhir_documents_is_healthprep_generated, fhir_documents.last_accessed AS fhir_documents_last_accessed, fhir_documents.created_at AS fhir_documents_created_at, fhir_documents.updated_at AS fhir_documents_updated_at 
FROM fhir_documents 
WHERE fhir_documents.patient_id = %(patient_id_1)s]
[parameters: {'patient_id_1': 10}]
(Background on this error at: https://sqlalche.me/e/20/f405)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/flask_login/utils.py", line 290, in decorated_view
    return current_app.ensure_sync(func)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/routes/admin_routes.py", line 469, in decorated_function
    return f(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/routes/admin_routes.py", line 2251, in admin_documents
    return render_template('error/500.html'), 500
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/flask/templating.py", line 150, in render_template
    return _render(app, template, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/flask/templating.py", line 127, in _render
    app.update_template_context(context)
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/flask/app.py", line 530, in update_template_context
    context.update(self.ensure_sync(func)())
                   ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/app.py", line 374, in inject_subscription_status
    return get_subscription_context()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/middleware/subscription_check.py", line 178, in get_subscription_context
    org = current_user.organization
          ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 569, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1096, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1131, in _fire_loader_callables
    return self.callable_(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/strategies.py", line 978, in _load_for_state
    return self._emit_lazyload(
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/strategies.py", line 1079, in _emit_lazyload
    return loading.load_on_pk_identity(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/loading.py", line 694, in load_on_pk_identity
    session.execute(
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
           ^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1840, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1980, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT organizations.id AS organizations_id, organizations.name AS organizations_name, organizations.display_name AS organizations_display_name, organizations.address AS organizations_address, organizations.contact_email AS organizations_contact_email, organizations.phone AS organizations_phone, organizations.epic_client_id AS organizations_epic_client_id, organizations.epic_client_secret AS organizations_epic_client_secret, organizations.epic_fhir_url AS organizations_epic_fhir_url, organizations.epic_environment AS organizations_epic_environment, organizations.epic_production_base_url AS organizations_epic_production_base_url, organizations.epic_endpoint_id AS organizations_epic_endpoint_id, organizations.epic_organization_id AS organizations_epic_organization_id, organizations.epic_oauth_url AS organizations_epic_oauth_url, organizations.epic_token_url AS organizations_epic_token_url, organizations.fhir_rate_limit_per_hour AS organizations_fhir_rate_limit_per_hour, organizations.max_batch_size AS organizations_max_batch_size, organizations.async_processing_enabled AS organizations_async_processing_enabled, organizations.audit_retention_days AS organizations_audit_retention_days, organizations.phi_logging_level AS organizations_phi_logging_level, organizations.is_epic_connected AS organizations_is_epic_connected, organizations.last_epic_sync AS organizations_last_epic_sync, organizations.last_epic_error AS organizations_last_epic_error, organizations.epic_token_expiry AS organizations_epic_token_expiry, organizations.connection_retry_count AS organizations_connection_retry_count, organizations.next_token_check AS organizations_next_token_check, organizations.epic_app_name AS organizations_epic_app_name, organizations.epic_app_description AS organizations_epic_app_description, organizations.epic_registration_status AS organizations_epic_registration_status, organizations.epic_registration_date AS organizations_epic_registration_date, organizations.setup_status AS organizations_setup_status, organizations.custom_presets_enabled AS organizations_custom_presets_enabled, organizations.auto_sync_enabled AS organizations_auto_sync_enabled, organizations.max_users AS organizations_max_users, organizations.appointment_based_prioritization AS organizations_appointment_based_prioritization, organizations.prioritization_window_days AS organizations_prioritization_window_days, organizations.process_non_scheduled_patients AS organizations_process_non_scheduled_patients, organizations.last_appointment_sync AS organizations_last_appointment_sync, organizations.site AS organizations_site, organizations.specialty AS organizations_specialty, organizations.stripe_customer_id AS organizations_stripe_customer_id, organizations.stripe_subscription_id AS organizations_stripe_subscription_id, organizations.subscription_status AS organizations_subscription_status, organizations.trial_start_date AS organizations_trial_start_date, organizations.billing_email AS organizations_billing_email, organizations.owner_email AS organizations_owner_email, organizations.creation_method AS organizations_creation_method, organizations.onboarding_status AS organizations_onboarding_status, organizations.signup_completion_token AS organizations_signup_completion_token, organizations.signup_completion_token_expires AS organizations_signup_completion_token_expires, organizations.approved_at AS organizations_approved_at, organizations.approved_by AS organizations_approved_by, organizations.created_at AS organizations_created_at, organizations.updated_at AS organizations_updated_at, organizations.trial_expires AS organizations_trial_expires 
FROM organizations 
WHERE organizations.id = %(pk_1)s]
[parameters: {'pk_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
10.81.0.152 - - [12/Dec/2025:20:33:15 +0000] "GET /admin/documents HTTP/1.1" 500 12326 "https://55ab1b06-006d-47ec-9b73-b827f4e0f641-00-1fje9legmrd1y.riker.replit.dev/admin/dashboard/logs" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Replit/1.0.14 Chrome/124.0.6367.119 Electron/30.0.3 Safari/537.36"
INFO:flask_wtf.csrf:The CSRF token is missing.
10.81.0.152 - - [12/Dec/2025:20:33:16 +0000] "POST /admin/log-error HTTP/1.1" 400 6638 "https://55ab1b06-006d-47ec-9b73-b827f4e0f641-00-1fje9legmrd1y.riker.replit.dev/admin/documents" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Replit/1.0.14 Chrome/124.0.6367.119 Electron/30.0.3 Safari/537.36"
ERROR:routes.admin_routes:Error in admin documents: (psycopg2.errors.UndefinedColumn) column fhir_documents.is_healthprep_generated does not exist
LINE 1: ...elevance_score AS fhir_documents_relevance_score, fhir_docum...
                                                             ^

[SQL: SELECT fhir_documents.id AS fhir_documents_id, fhir_documents.patient_id AS fhir_documents_patient_id, fhir_documents.org_id AS fhir_documents_org_id, fhir_documents.epic_document_id AS fhir_documents_epic_document_id, fhir_documents.fhir_document_reference AS fhir_documents_fhir_document_reference, fhir_documents.document_type_code AS fhir_documents_document_type_code, fhir_documents.document_type_display AS fhir_documents_document_type_display, fhir_documents.title AS fhir_documents_title, fhir_documents.description AS fhir_documents_description, fhir_documents.creation_date AS fhir_documents_creation_date, fhir_documents.document_date AS fhir_documents_document_date, fhir_documents.author_name AS fhir_documents_author_name, fhir_documents.content_url AS fhir_documents_content_url, fhir_documents.content_type AS fhir_documents_content_type, fhir_documents.content_size AS fhir_documents_content_size, fhir_documents.content_hash AS fhir_documents_content_hash, fhir_documents.is_processed AS fhir_documents_is_processed, fhir_documents.processing_status AS fhir_documents_processing_status, fhir_documents.processing_error AS fhir_documents_processing_error, fhir_documents.ocr_text AS fhir_documents_ocr_text, fhir_documents.relevance_score AS fhir_documents_relevance_score, fhir_documents.is_healthprep_generated AS fhir_documents_is_healthprep_generated, fhir_documents.last_accessed AS fhir_documents_last_accessed, fhir_documents.created_at AS fhir_documents_created_at, fhir_documents.updated_at AS fhir_documents_updated_at 
FROM fhir_documents 
WHERE fhir_documents.patient_id = %(patient_id_1)s]
[parameters: {'patient_id_1': 10}]
(Background on this error at: https://sqlalche.me/e/20/f405)
ERROR:app:Exception on /admin/documents [GET]
Traceback (most recent call last):
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.UndefinedColumn: column fhir_documents.is_healthprep_generated does not exist
LINE 1: ...elevance_score AS fhir_documents_relevance_score, fhir_docum...
                                                             ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/runner/workspace/routes/admin_routes.py", line 2125, in admin_documents
    fhir_documents = FHIRDocument.query.filter_by(patient_id=patient.id).all()
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2704, in all
    return self._iter().all()  # type: ignore
           ^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/query.py", line 2857, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
                                                  ^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
           ^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1840, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1980, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedColumn) column fhir_documents.is_healthprep_generated does not exist
LINE 1: ...elevance_score AS fhir_documents_relevance_score, fhir_docum...
                                                             ^

[SQL: SELECT fhir_documents.id AS fhir_documents_id, fhir_documents.patient_id AS fhir_documents_patient_id, fhir_documents.org_id AS fhir_documents_org_id, fhir_documents.epic_document_id AS fhir_documents_epic_document_id, fhir_documents.fhir_document_reference AS fhir_documents_fhir_document_reference, fhir_documents.document_type_code AS fhir_documents_document_type_code, fhir_documents.document_type_display AS fhir_documents_document_type_display, fhir_documents.title AS fhir_documents_title, fhir_documents.description AS fhir_documents_description, fhir_documents.creation_date AS fhir_documents_creation_date, fhir_documents.document_date AS fhir_documents_document_date, fhir_documents.author_name AS fhir_documents_author_name, fhir_documents.content_url AS fhir_documents_content_url, fhir_documents.content_type AS fhir_documents_content_type, fhir_documents.content_size AS fhir_documents_content_size, fhir_documents.content_hash AS fhir_documents_content_hash, fhir_documents.is_processed AS fhir_documents_is_processed, fhir_documents.processing_status AS fhir_documents_processing_status, fhir_documents.processing_error AS fhir_documents_processing_error, fhir_documents.ocr_text AS fhir_documents_ocr_text, fhir_documents.relevance_score AS fhir_documents_relevance_score, fhir_documents.is_healthprep_generated AS fhir_documents_is_healthprep_generated, fhir_documents.last_accessed AS fhir_documents_last_accessed, fhir_documents.created_at AS fhir_documents_created_at, fhir_documents.updated_at AS fhir_documents_updated_at 
FROM fhir_documents 
WHERE fhir_documents.patient_id = %(patient_id_1)s]
[parameters: {'patient_id_1': 10}]
(Background on this error at: https://sqlalche.me/e/20/f405)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
psycopg2.errors.InFailedSqlTransaction: current transaction is aborted, commands ignored until end of transaction block


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/flask_cors/extension.py", line 176, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
                                                ^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/flask_login/utils.py", line 290, in decorated_view
    return current_app.ensure_sync(func)(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/routes/admin_routes.py", line 469, in decorated_function
    return f(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/routes/admin_routes.py", line 2251, in admin_documents
    return render_template('error/500.html'), 500
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/flask/templating.py", line 150, in render_template
    return _render(app, template, context)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/flask/templating.py", line 127, in _render
    app.update_template_context(context)
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/flask/app.py", line 530, in update_template_context
    context.update(self.ensure_sync(func)())
                   ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/app.py", line 374, in inject_subscription_status
    return get_subscription_context()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/middleware/subscription_check.py", line 178, in get_subscription_context
    org = current_user.organization
          ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 569, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1096, in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py", line 1131, in _fire_loader_callables
    return self.callable_(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/strategies.py", line 978, in _load_for_state
    return self._emit_lazyload(
           ^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/strategies.py", line 1079, in _emit_lazyload
    return loading.load_on_pk_identity(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/loading.py", line 694, in load_on_pk_identity
    session.execute(
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1413, in execute
    return meth(
           ^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1840, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1980, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2349, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1961, in _exec_single_context
    self.dialect.do_execute(
  File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 944, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InternalError: (psycopg2.errors.InFailedSqlTransaction) current transaction is aborted, commands ignored until end of transaction block

[SQL: SELECT organizations.id AS organizations_id, organizations.name AS organizations_name, organizations.display_name AS organizations_display_name, organizations.address AS organizations_address, organizations.contact_email AS organizations_contact_email, organizations.phone AS organizations_phone, organizations.epic_client_id AS organizations_epic_client_id, organizations.epic_client_secret AS organizations_epic_client_secret, organizations.epic_fhir_url AS organizations_epic_fhir_url, organizations.epic_environment AS organizations_epic_environment, organizations.epic_production_base_url AS organizations_epic_production_base_url, organizations.epic_endpoint_id AS organizations_epic_endpoint_id, organizations.epic_organization_id AS organizations_epic_organization_id, organizations.epic_oauth_url AS organizations_epic_oauth_url, organizations.epic_token_url AS organizations_epic_token_url, organizations.fhir_rate_limit_per_hour AS organizations_fhir_rate_limit_per_hour, organizations.max_batch_size AS organizations_max_batch_size, organizations.async_processing_enabled AS organizations_async_processing_enabled, organizations.audit_retention_days AS organizations_audit_retention_days, organizations.phi_logging_level AS organizations_phi_logging_level, organizations.is_epic_connected AS organizations_is_epic_connected, organizations.last_epic_sync AS organizations_last_epic_sync, organizations.last_epic_error AS organizations_last_epic_error, organizations.epic_token_expiry AS organizations_epic_token_expiry, organizations.connection_retry_count AS organizations_connection_retry_count, organizations.next_token_check AS organizations_next_token_check, organizations.epic_app_name AS organizations_epic_app_name, organizations.epic_app_description AS organizations_epic_app_description, organizations.epic_registration_status AS organizations_epic_registration_status, organizations.epic_registration_date AS organizations_epic_registration_date, organizations.setup_status AS organizations_setup_status, organizations.custom_presets_enabled AS organizations_custom_presets_enabled, organizations.auto_sync_enabled AS organizations_auto_sync_enabled, organizations.max_users AS organizations_max_users, organizations.appointment_based_prioritization AS organizations_appointment_based_prioritization, organizations.prioritization_window_days AS organizations_prioritization_window_days, organizations.process_non_scheduled_patients AS organizations_process_non_scheduled_patients, organizations.last_appointment_sync AS organizations_last_appointment_sync, organizations.site AS organizations_site, organizations.specialty AS organizations_specialty, organizations.stripe_customer_id AS organizations_stripe_customer_id, organizations.stripe_subscription_id AS organizations_stripe_subscription_id, organizations.subscription_status AS organizations_subscription_status, organizations.trial_start_date AS organizations_trial_start_date, organizations.billing_email AS organizations_billing_email, organizations.owner_email AS organizations_owner_email, organizations.creation_method AS organizations_creation_method, organizations.onboarding_status AS organizations_onboarding_status, organizations.signup_completion_token AS organizations_signup_completion_token, organizations.signup_completion_token_expires AS organizations_signup_completion_token_expires, organizations.approved_at AS organizations_approved_at, organizations.approved_by AS organizations_approved_by, organizations.created_at AS organizations_created_at, organizations.updated_at AS organizations_updated_at, organizations.trial_expires AS organizations_trial_expires 
FROM organizations 
WHERE organizations.id = %(pk_1)s]
[parameters: {'pk_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/2j85)
10.81.0.152 - - [12/Dec/2025:20:33:26 +0000] "GET /admin/documents?retry=1 HTTP/1.1" 500 12326 "https://55ab1b06-006d-47ec-9b73-b827f4e0f641-00-1fje9legmrd1y.riker.replit.dev/admin/documents" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Replit/1.0.14 Chrome/124.0.6367.119 Electron/30.0.3 Safari/537.36"
INFO:flask_wtf.csrf:The CSRF token is missing.
10.81.0.152 - - [12/Dec/2025:20:33:26 +0000] "POST /admin/log-error HTTP/1.1" 400 6638 "https://55ab1b06-006d-47ec-9b73-b827f4e0f641-00-1fje9legmrd1y.riker.replit.dev/admin/documents?retry=1" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Replit/1.0.14 Chrome/124.0.6367.119 Electron/30.0.3 Safari/537.36"
