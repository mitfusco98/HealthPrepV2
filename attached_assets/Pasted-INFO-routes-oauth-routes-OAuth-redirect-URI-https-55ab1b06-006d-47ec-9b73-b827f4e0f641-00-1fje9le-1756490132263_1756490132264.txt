INFO:routes.oauth_routes:OAuth redirect URI: https://55ab1b06-006d-47ec-9b73-b827f4e0f641-00-1fje9legmrd1y.riker.replit.dev/oauth/epic-callback
INFO:routes.oauth_routes:Epic client ID: e57377e2-dfd5-4675-9659-58c33aa67b3f
INFO:routes.oauth_routes:Epic auth URL: https://fhir.epic.com/interconnect-fhir-oauth/oauth2/authorize
INFO:emr.fhir_client:Epic OAuth Parameters:
INFO:emr.fhir_client:  response_type: code
INFO:emr.fhir_client:  client_id: e57377e2-dfd5-4675-9659-58c33aa67b3f
INFO:emr.fhir_client:  redirect_uri: https://55ab1b06-006d-47ec-9b73-b827f4e0f641-00-1fje9legmrd1y.riker.replit.dev/oauth/epic-callback
INFO:emr.fhir_client:  scope: openid fhirUser patient/Patient.read patient/Condition.read patient/Observation.read patient/DocumentReference.read patient/Encounter.read user/Patient.read user/Condition.read user/Observation.read user/DocumentReference.read user/Encounter.read
INFO:emr.fhir_client:  aud: https://fhir.epic.com/interconnect-fhir-oauth/api/FHIR/R4/
INFO:emr.fhir_client:  state: fIXl6CwwDHyFHlsEKvUZCl_sEyf9iHxu2impnJSvN08
INFO:emr.fhir_client:Generated Epic authorization URL: https://fhir.epic.com/interconnect-fhir-oauth/oauth2/authorize?response_type=code&client_id=e57377e2-dfd5-4675-9659-58c33aa67b3f&redirect_uri=https%3A%2F%2F55ab1b06-006d-47ec-9b73-b827f4e0f641-00-1fje9legmrd1y.riker.replit.dev%2Foauth%2Fepic-callback&scope=openid+fhirUser+patient%2FPatient.read+patient%2FCondition.read+patient%2FObservation.read+patient%2FDocumentReference.read+patient%2FEncounter.read+user%2FPatient.read+user%2FCondition.read+user%2FObservation.read+user%2FDocumentReference.read+user%2FEncounter.read&aud=https%3A%2F%2Ffhir.epic.com%2Finterconnect-fhir-oauth%2Fapi%2FFHIR%2FR4%2F&state=fIXl6CwwDHyFHlsEKvUZCl_sEyf9iHxu2impnJSvN08
INFO:routes.oauth_routes:Starting Epic OAuth flow for organization 1
INFO:werkzeug:10.81.8.59 - - [29/Aug/2025 17:41:01] "GET /oauth/epic-authorize HTTP/1.1" 302 -
INFO:routes.oauth_routes:=== Epic OAuth Callback Debug ===
INFO:routes.oauth_routes:Request URL: https://55ab1b06-006d-47ec-9b73-b827f4e0f641-00-1fje9legmrd1y.riker.replit.dev/oauth/epic-callback?code=eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOiJ1cm46b2lkOjEuMi44NDAuMTE0MzUwLjEuMTMuMC4xLjcuMy42ODg4ODQuMTAwIiwiY2xpZW50X2lkIjoiZTU3Mzc3ZTItZGZkNS00Njc1LTk2NTktNThjMzNhYTY3YjNmIiwiZXBpYy5lY2kiOiJ1cm46ZXBpYzpPcGVuLkVwaWMtY3VycmVudCIsImVwaWMubWV0YWRhdGEiOiJuVEpBei1RM2RvYm5WZXVwZmdweTc2UEdrUV9DMkVpSmxuUS1FbXl5c3pPaWJOSGltRl8xMVo2a1lJY0lORk0xLXRqRHB3dGRVc3VnLXB1TlFOWUhRVjBJcXFxYUpSTDFNNXhENE0tSU1Kd2FRM2RpWWFEZTZDblRTQzNNdFdVLSIsImVwaWMudG9rZW50eXBlIjoiY29kZSIsImV4cCI6MTc1NjQ4OTYwNiwiaWF0IjoxNzU2NDg5MzA2LCJpc3MiOiJ1cm46b2lkOjEuMi44NDAuMTE0MzUwLjEuMTMuMC4xLjcuMy42ODg4ODQuMTAwIiwianRpIjoiNDQwNWUwZWQtMzc0NC00Mzk5LTk4NmYtNjY1NDg4NTRlZmUwIiwibmJmIjoxNzU2NDg5MzA2LCJzdWIiOiJlNmF3Ni1SSnVLTzJtYnFqbGVLdmdWUTMifQ.mj74Tjd-zPMccWGJC5lEZnOFzaWxVl8B8F0HnTSP123IkOJ8Opa6wQPNoHiRBXAK97kHt90QDFtNjN09lneYQljEpuKtso6633GQGDcoJbFKgXU-AeFcc3R_wNoL8vbO44Q1WVQ2lLP3sDpgr_-AmwSy_9yvJhjF0ZtDK0C_d0cb_6rxUPIjm5LR8z8LtSRgh0l2FZfWUZApwR-aHeHLXgQ7p6IbipHKXHHBKtstzN0cyAKl8pY0y2RO7eJLknGx6wrv_qxFfE0G1VoPNdOiW_oy2LZiSceMnVZRHXBPrkErvoF3Z2_7WaqobC8FvIaarGSDBwawE7gisDGcqfHpuA&state=fIXl6CwwDHyFHlsEKvUZCl_sEyf9iHxu2impnJSvN08
INFO:routes.oauth_routes:Request method: GET
INFO:routes.oauth_routes:Request headers: {'Host': '55ab1b06-006d-47ec-9b73-b827f4e0f641-00-1fje9legmrd1y.riker.replit.dev', 'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Replit/1.0.14 Chrome/124.0.6367.119 Electron/30.0.3 Safari/537.36', 'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7', 'Accept-Encoding': 'gzip, deflate, br', 'Accept-Language': 'en-US', 'Cookie': 'session=.eJw1jstOAzEMRf8la4rsPMbJbEtRAYkNICE2o8Rx1BF9aR4tFeLfCQiW17rH93yqrgwyblQ7DbNcqa7PqlXI2TgpwSQw7COU1GQmbAoSahcpYMO-xGBA2-xcNhAQRQeLOkZXgphMKegIGrINATCRTVzIR--yQ_CgY0OcKNioC1EmhKgTcyj0s6aqyDzK8GdTI49D6abDu-zroeEkgoUJKHEVNSZmCZ4FGy0aBXJMwmwrJ8eeuzhPm27qdzJOcXesDzRotwC_0OEZqbXYAl5bD97jP3L4ZWp_ktovd6_bZnk-36wvt-vtuHo4vbwtt924upTQrz9m3e-O-_un0yN49fUNEc5lKw.aLHmLQ.Agzy8dTwayTHkr3jMTaN3Aa0-4M', 'Referer': 'https://fhir.epic.com/', 'Sec-Fetch-Dest': 'document', 'Sec-Fetch-Mode': 'navigate', 'Sec-Fetch-Site': 'cross-site', 'Sec-Fetch-User': '?1', 'Upgrade-Insecure-Requests': '1', 'X-Forwarded-For': '69.207.59.155, 10.81.8.59', 'X-Forwarded-Proto': 'https', 'X-Replit-User-Bio': '', 'X-Replit-User-Id': '', 'X-Replit-User-Name': '', 'X-Replit-User-Profile-Image': '', 'X-Replit-User-Roles': '', 'X-Replit-User-Teams': '', 'X-Replit-User-Url': ''}
INFO:routes.oauth_routes:Query parameters received:
INFO:routes.oauth_routes:  - code: <present>
INFO:routes.oauth_routes:  - state: <present>
INFO:routes.oauth_routes:  - error: None
INFO:routes.oauth_routes:  - error_description: None
INFO:routes.oauth_routes:  - all query args: {'code': 'eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOiJ1cm46b2lkOjEuMi44NDAuMTE0MzUwLjEuMTMuMC4xLjcuMy42ODg4ODQuMTAwIiwiY2xpZW50X2lkIjoiZTU3Mzc3ZTItZGZkNS00Njc1LTk2NTktNThjMzNhYTY3YjNmIiwiZXBpYy5lY2kiOiJ1cm46ZXBpYzpPcGVuLkVwaWMtY3VycmVudCIsImVwaWMubWV0YWRhdGEiOiJuVEpBei1RM2RvYm5WZXVwZmdweTc2UEdrUV9DMkVpSmxuUS1FbXl5c3pPaWJOSGltRl8xMVo2a1lJY0lORk0xLXRqRHB3dGRVc3VnLXB1TlFOWUhRVjBJcXFxYUpSTDFNNXhENE0tSU1Kd2FRM2RpWWFEZTZDblRTQzNNdFdVLSIsImVwaWMudG9rZW50eXBlIjoiY29kZSIsImV4cCI6MTc1NjQ4OTYwNiwiaWF0IjoxNzU2NDg5MzA2LCJpc3MiOiJ1cm46b2lkOjEuMi44NDAuMTE0MzUwLjEuMTMuMC4xLjcuMy42ODg4ODQuMTAwIiwianRpIjoiNDQwNWUwZWQtMzc0NC00Mzk5LTk4NmYtNjY1NDg4NTRlZmUwIiwibmJmIjoxNzU2NDg5MzA2LCJzdWIiOiJlNmF3Ni1SSnVLTzJtYnFqbGVLdmdWUTMifQ.mj74Tjd-zPMccWGJC5lEZnOFzaWxVl8B8F0HnTSP123IkOJ8Opa6wQPNoHiRBXAK97kHt90QDFtNjN09lneYQljEpuKtso6633GQGDcoJbFKgXU-AeFcc3R_wNoL8vbO44Q1WVQ2lLP3sDpgr_-AmwSy_9yvJhjF0ZtDK0C_d0cb_6rxUPIjm5LR8z8LtSRgh0l2FZfWUZApwR-aHeHLXgQ7p6IbipHKXHHBKtstzN0cyAKl8pY0y2RO7eJLknGx6wrv_qxFfE0G1VoPNdOiW_oy2LZiSceMnVZRHXBPrkErvoF3Z2_7WaqobC8FvIaarGSDBwawE7gisDGcqfHpuA', 'state': 'fIXl6CwwDHyFHlsEKvUZCl_sEyf9iHxu2impnJSvN08'}
INFO:routes.oauth_routes:Session state: fIXl6CwwDHyFHlsEKvUZCl_sEyf9iHxu2impnJSvN08
INFO:routes.oauth_routes:Session user: True
INFO:routes.oauth_routes:================================
INFO:routes.oauth_routes:Token exchange - redirect URI: https://55ab1b06-006d-47ec-9b73-b827f4e0f641-00-1fje9legmrd1y.riker.replit.dev/oauth/epic-callback
INFO:routes.oauth_routes:Token exchange - client ID: e57377e2-dfd5-4675-9659-58c33aa67b3f
INFO:routes.oauth_routes:Token exchange - token URL: https://fhir.epic.com/interconnect-fhir-oauth/oauth2/token
INFO:emr.fhir_client:Token exchange request:
INFO:emr.fhir_client:  - URL: https://fhir.epic.com/interconnect-fhir-oauth/oauth2/token
INFO:emr.fhir_client:  - client_id: e57377e2-dfd5-4675-9659-58c33aa67b3f
INFO:emr.fhir_client:  - redirect_uri: https://55ab1b06-006d-47ec-9b73-b827f4e0f641-00-1fje9legmrd1y.riker.replit.dev/oauth/epic-callback
INFO:emr.fhir_client:  - grant_type: authorization_code
INFO:emr.fhir_client:  - code: <present>
INFO:emr.fhir_client:Token exchange response:
INFO:emr.fhir_client:  - status_code: 200
INFO:emr.fhir_client:  - headers: {'Cache-Control': 'no-cache, no-store,no-store', 'Pragma': 'no-cache', 'Content-Type': 'application/json; charset=utf-8', 'Expires': '-1', 'Set-Cookie': 'ASP.NET_SessionId=boeekwxmvw3fll0qw1tm4k11; path=/Interconnect-fhir-oauth; secure; HttpOnly; SameSite=Lax, EpicPersistenceCookie=!tt26u1qPLKNmeF1c5iqg712Vrh0WW7/yBdjAHMyzJNZ5VX+VZuSAPn6mKu3CPbWb50XQBlQ6AVe/moM=; path=/; Httponly; Secure', 'ServerMetrics': '{"BlockReads":9,"BlockWrites":2,"BlocksAllocated":0,"DBTime":52,"DatabaseCPUTime":35,"ECFNetworkTime":2,"ECFRequestCount":1,"ECFRequestTime":54,"GREF":2273,"JournalEntries":1,"LockWait":0.045,"LocksFailed":0,"LocksGranted":0,"MCommands":44449,"MemoryDifference":0,"NetworkCacheMisses":0,"NetworkUpdates":0,"WorkflowEventBlockReads":9,"WorkflowEventDBTime":52,"WorkflowEventECFNetworkTime":1,"WorkflowEventECFRequestCount":1,"WorkflowEventGREF":2273}', 'Strict-Transport-Security': 'max-age=31536000; includeSubDomains', 'X-Frame-Options': 'sameorigin', 'Access-Control-Allow-Headers': 'origin, authorization, accept, content-type, x-requested-with, prefer, Epic-User-ID, Epic-User-IDType, Epic-Client-ID, soapaction, Epic-MyChartUser-ID, Epic-MyChartUser-IDType', 'Access-Control-Allow-Methods': 'GET, HEAD, POST, PUT, DELETE, TRACE, OPTIONS', 'Access-Control-Allow-Origin': '*', 'Access-Control-Allow-Credentials': 'true', 'Date': 'Fri, 29 Aug 2025 17:41:46 GMT', 'Content-Length': '3386'}
INFO:emr.fhir_client:Successfully exchanged authorization code for Epic access token
INFO:routes.oauth_routes:Epic OAuth flow completed successfully for organization 1
INFO:werkzeug:10.81.8.59 - - [29/Aug/2025 17:41:47] "GET /oauth/epic-callback?code=eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOiJ1cm46b2lkOjEuMi44NDAuMTE0MzUwLjEuMTMuMC4xLjcuMy42ODg4ODQuMTAwIiwiY2xpZW50X2lkIjoiZTU3Mzc3ZTItZGZkNS00Njc1LTk2NTktNThjMzNhYTY3YjNmIiwiZXBpYy5lY2kiOiJ1cm46ZXBpYzpPcGVuLkVwaWMtY3VycmVudCIsImVwaWMubWV0YWRhdGEiOiJuVEpBei1RM2RvYm5WZXVwZmdweTc2UEdrUV9DMkVpSmxuUS1FbXl5c3pPaWJOSGltRl8xMVo2a1lJY0lORk0xLXRqRHB3dGRVc3VnLXB1TlFOWUhRVjBJcXFxYUpSTDFNNXhENE0tSU1Kd2FRM2RpWWFEZTZDblRTQzNNdFdVLSIsImVwaWMudG9rZW50eXBlIjoiY29kZSIsImV4cCI6MTc1NjQ4OTYwNiwiaWF0IjoxNzU2NDg5MzA2LCJpc3MiOiJ1cm46b2lkOjEuMi44NDAuMTE0MzUwLjEuMTMuMC4xLjcuMy42ODg4ODQuMTAwIiwianRpIjoiNDQwNWUwZWQtMzc0NC00Mzk5LTk4NmYtNjY1NDg4NTRlZmUwIiwibmJmIjoxNzU2NDg5MzA2LCJzdWIiOiJlNmF3Ni1SSnVLTzJtYnFqbGVLdmdWUTMifQ.mj74Tjd-zPMccWGJC5lEZnOFzaWxVl8B8F0HnTSP123IkOJ8Opa6wQPNoHiRBXAK97kHt90QDFtNjN09lneYQljEpuKtso6633GQGDcoJbFKgXU-AeFcc3R_wNoL8vbO44Q1WVQ2lLP3sDpgr_-AmwSy_9yvJhjF0ZtDK0C_d0cb_6rxUPIjm5LR8z8LtSRgh0l2FZfWUZApwR-aHeHLXgQ7p6IbipHKXHHBKtstzN0cyAKl8pY0y2RO7eJLknGx6wrv_qxFfE0G1VoPNdOiW_oy2LZiSceMnVZRHXBPrkErvoF3Z2_7WaqobC8FvIaarGSDBwawE7gisDGcqfHpuA&state=fIXl6CwwDHyFHlsEKvUZCl_sEyf9iHxu2impnJSvN08 HTTP/1.1" 302 -
INFO:werkzeug:10.81.8.59 - - [29/Aug/2025 17:41:47] "GET /admin/epic/registration HTTP/1.1" 200 -
INFO:werkzeug:10.81.4.99 - - [29/Aug/2025 17:41:47] "GET /static/css/custom.css HTTP/1.1" 304 -
INFO:werkzeug:10.81.9.244 - - [29/Aug/2025 17:41:47] "GET /static/css/loading-states.css HTTP/1.1" 304 -
INFO:werkzeug:10.81.9.244 - - [29/Aug/2025 17:41:49] "GET /oauth/epic-status HTTP/1.1" 200 -
INFO:werkzeug:10.81.9.244 - - [29/Aug/2025 17:41:50] "GET /oauth/epic-status HTTP/1.1" 200 -
INFO:werkzeug:10.81.4.99 - - [29/Aug/2025 17:41:50] "GET /admin/epic/registration HTTP/1.1" 200 -
INFO:werkzeug:10.81.8.59 - - [29/Aug/2025 17:41:51] "GET /static/css/custom.css HTTP/1.1" 304 -
INFO:werkzeug:10.81.4.99 - - [29/Aug/2025 17:41:51] "GET /static/css/loading-states.css HTTP/1.1" 304 -
INFO:werkzeug:10.81.9.244 - - [29/Aug/2025 17:41:51] "GET /oauth/epic-status HTTP/1.1" 200 -
INFO:werkzeug:10.81.4.99 - - [29/Aug/2025 17:42:00] "GET /oauth/epic-status HTTP/1.1" 200 -
INFO:werkzeug:10.81.4.99 - - [29/Aug/2025 17:42:01] "GET /oauth/epic-status HTTP/1.1" 200 -
INFO:werkzeug:10.81.4.99 - - [29/Aug/2025 17:42:30] "GET /auth/logout HTTP/1.1" 302 -
INFO:werkzeug:10.81.4.99 - - [29/Aug/2025 17:42:30] "GET /auth/login HTTP/1.1" 200 -
INFO:werkzeug:10.81.4.99 - - [29/Aug/2025 17:42:30] "GET /static/css/custom.css HTTP/1.1" 304 -
INFO:werkzeug:10.81.8.59 - - [29/Aug/2025 17:42:30] "GET /static/css/loading-states.css HTTP/1.1" 304 -
INFO:werkzeug:10.81.9.244 - - [29/Aug/2025 17:42:30] "GET /static/css/medical_terminology_ui.css HTTP/1.1" 304 -
INFO:werkzeug:10.81.4.99 - - [29/Aug/2025 17:42:30] "GET /static/js/medical_terminology.js HTTP/1.1" 304 -
INFO:werkzeug:10.81.4.99 - - [29/Aug/2025 17:42:39] "POST /auth/login HTTP/1.1" 302 -
INFO:werkzeug:10.81.4.99 - - [29/Aug/2025 17:42:39] "GET /admin/dashboard HTTP/1.1" 302 -
INFO:werkzeug:10.81.4.99 - - [29/Aug/2025 17:42:40] "GET /admin/dashboard/logs HTTP/1.1" 200 -
INFO:werkzeug:10.81.9.244 - - [29/Aug/2025 17:42:40] "GET /static/css/custom.css HTTP/1.1" 304 -
INFO:werkzeug:10.81.8.59 - - [29/Aug/2025 17:42:40] "GET /static/css/loading-states.css HTTP/1.1" 304 -
INFO:werkzeug:10.81.4.99 - - [29/Aug/2025 17:42:45] "GET /admin/epic/registration HTTP/1.1" 200 -
INFO:werkzeug:10.81.8.59 - - [29/Aug/2025 17:42:46] "GET /static/css/custom.css HTTP/1.1" 304 -
INFO:werkzeug:10.81.9.244 - - [29/Aug/2025 17:42:46] "GET /static/css/loading-states.css HTTP/1.1" 304 -
INFO:werkzeug:10.81.9.244 - - [29/Aug/2025 17:42:49] "GET /oauth/epic-status HTTP/1.1" 200 -
INFO:werkzeug:10.81.9.244 - - [29/Aug/2025 17:42:49] "GET /oauth/epic-status HTTP/1.1" 200 -